<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ì—°ì•  ìœ¡ì„± ì‹œë®¬ë ˆì´ì…˜</title>
  <style>
    :root{
      --bg:#0f1115;--panel:#171a21;--muted:#8c98a9;--hl:#86e1ff;--good:#42d392;--bad:#ff6b6b;--warn:#ffd166;--ink:#e5ecf4;
    }
    *{box-sizing:border-box}
    html,body{height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    body{margin:0;display:flex;justify-content:center}
    .app{width:100%;max-width:560px;min-height:100vh;display:flex;flex-direction:column;padding-bottom:88px}
    header{padding:12px 14px;border-bottom:1px solid #222}
    header .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .badge{background:#1f2430;border:1px solid #2a3140;color:#c6d6ee;padding:4px 8px;border-radius:10px;font-size:12px}
    .time-chip{display:inline-flex;gap:6px;align-items:center}
    .time-dot{width:8px;height:8px;border-radius:50%}
    .dot-morning{background:#ffd166}
    .dot-day{background:#86e1ff}
    .dot-evening{background:#ff6b6b}

    /* Collapsible stats */
    details.stats{background:var(--panel);border-top:1px solid #1f2330;border-bottom:1px solid #1f2330}
    details.stats>summary{list-style:none;padding:10px 14px;cursor:pointer;user-select:none;display:flex;align-items:center;gap:10px}
    details.stats>summary::-webkit-details-marker{display:none}
    .chev{transition:transform .25s ease}
    details[open] .chev{transform:rotate(90deg)}
    .stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 14px 14px}
    .card{background:#12151c;border:1px solid #1e2330;border-radius:12px;padding:10px}
    .stat-name{font-size:12px;color:var(--muted)}
    .stat-value{font-weight:700;margin-top:4px}
    .bar{height:6px;background:#0b0f16;border-radius:6px;margin-top:8px;position:relative}
    .bar>i{position:absolute;left:0;top:0;bottom:0;border-radius:6px;background:linear-gradient(90deg,#4ad,#7af)}
    .inv{padding:10px 14px;display:flex;gap:8px;flex-wrap:wrap}
    .tag{border:1px dashed #2a3140;padding:2px 8px;border-radius:999px;font-size:12px}

    /* Illustration area */
    .illustration{height:50vh;min-height:300px;background:#0b0f16;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .illustration img{width:100%;height:100%;object-fit:cover;display:block}
    .img-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,.2),rgba(0,0,0,.6));pointer-events:none}
    .img-msg{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,.6);padding:6px 10px;border-radius:8px;font-size:12px}

    /* Action / Event panel */
    .panel{padding:12px 14px;background:var(--panel);border-top:1px solid #1f2330}
    .groups{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:8px}
    .group{flex:1 1 calc(50% - 10px)}
    .group h4{margin:0 0 8px 0;color:#c9d6f0;font-size:14px}
    .btns{display:flex;flex-wrap:wrap;gap:8px}
    button{background:#1a1f2b;border:1px solid #263147;color:#d3e0f7;border-radius:10px;padding:10px 12px;font-size:14px}
    button:disabled{opacity:.45;filter:grayscale(.3)}
    .row-slim{display:flex;gap:8px;align-items:center}
    .pill{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #2d374e;background:#141924;color:#aab9d6}

    .event-box{white-space:pre-wrap;line-height:1.55;background:#12151c;border:1px solid #242b3a;border-radius:12px;padding:12px}
    .hidden{display:none}

    .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#10141b;color:#e4f0ff;padding:10px 14px;border:1px solid #273246;border-radius:10px;font-size:14px;box-shadow:0 10px 30px rgba(0,0,0,.3);opacity:0;pointer-events:none}
    .toast.show{opacity:1;transition:opacity .25s ease}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="row">
        <div id="lblDay" class="badge">1ì¼ì§¸</div>
        <div class="time-chip badge" id="lblTime">
          <span class="time-dot dot-morning" id="dot"></span>
          <span id="timeText">ì•„ì¹¨</span>
        </div>
        <div class="badge" id="lblLevel">Lv.1</div>
      </div>
    </header>

    <details class="stats" id="stats">
      <summary>
        <span class="chev">â–¶</span>
        ìºë¦­í„° ìŠ¤íƒ¯ ë³´ê¸°
        <span class="pill" id="pillMult">ë°°ìˆ˜ m/s 1.0 / 1.0</span>
        <span class="pill" id="pillGold">GLD 100</span>
      </summary>
      <div class="stat-grid">
        <div class="card"><div class="stat-name">AFF í˜¸ê°</div><div class="stat-value" id="vAFF">0</div><div class="bar"><i id="bAFF" style="width:0%"></i></div></div>
        <div class="card"><div class="stat-name">TRU ì‹ ë¢°</div><div class="stat-value" id="vTRU">0</div><div class="bar"><i id="bTRU" style="width:0%"></i></div></div>
        <div class="card"><div class="stat-name">MOT ë™ê¸°</div><div class="stat-value" id="vMOT">0</div><div class="bar"><i id="bMOT" style="width:0%"></i></div></div>
        <div class="card"><div class="stat-name">MOOD ê¸°ë¶„(-2~+2)</div><div class="stat-value" id="vMOOD">0</div><div class="bar"><i id="bMOOD" style="width:50%"></i></div></div>
        <div class="card"><div class="stat-name">STR ìŠ¤íŠ¸ë ˆìŠ¤</div><div class="stat-value" id="vSTR">0</div><div class="bar"><i id="bSTR" style="width:0%"></i></div></div>
        <div class="card"><div class="stat-name">STM ê¸°ë ¥</div><div class="stat-value" id="vSTM">100</div><div class="bar"><i id="bSTM" style="width:100%"></i></div></div>
      </div>
      <div class="inv" id="inv"></div>
    </details>

    <div class="illustration" id="illu">
      <img id="illuImg" alt="illustration" />
      <div class="img-overlay"></div>
      <div class="img-msg" id="imgMsg">í–‰ë™ì„ ì„ íƒí•´ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <div class="panel">
      <!-- ACTIONS MODE -->
      <div id="actionsMode">
        <div class="groups">
          <div class="group">
            <h4>ë§ê±¸ê¸°</h4>
            <div class="btns">
              <button data-act="talk">ëŒ€í™”í•˜ê¸°</button>
              <button data-act="play">ë†€ì•„ì£¼ê¸°</button>
              <button data-act="study">ê³µë¶€í•˜ê¸°</button>
            </div>
          </div>
          <div class="group">
            <h4>ìŠ¤í‚¨ì‹­</h4>
            <div class="btns">
              <button data-act="pet" disabled>ì“°ë‹¤ë“¬ê¸°(L2)</button>
              <button data-act="hug" disabled>ê»´ì•ˆê¸°(L4)</button>
              <button data-act="kiss" disabled>í‚¤ìŠ¤(L5)</button>
            </div>
          </div>
          <div class="group">
            <h4>íœ´ì‹</h4>
            <div class="btns">
              <button data-act="rest">ê·¸ëƒ¥ ì‰¬ê¸°</button>
              <button data-act="tea">ì°¨ ë§ˆì‹œê¸°</button>
              <button data-act="sleep">ì ìê¸°</button>
              <button data-act="sleepTogether" disabled>í•¨ê»˜ ìê¸°(L6)</button>
            </div>
          </div>
<div class="group"><h4>ëª©ìš•</h4><div class="btns"><button data-act="bathTogether" disabled>í•¨ê»˜ ëª©ìš•(L7)</button></div></div>
          <div class="group">
            <h4>ì¼/ì‡¼í•‘</h4>
            <div class="btns">
              <button data-act="work">ì¼í•˜ê¸°</button>
              <button data-act="super">ìŠˆí¼</button>
              <button data-act="book">ì„œì </button>
              <button data-act="pharm">ì•½êµ­</button>
            </div>
          </div>
          <div class="group">
            <h4>íœ´ì¼ ì „ìš©</h4>
            <div class="btns">
              <button data-act="volunteer">ë´‰ì‚¬í™œë™</button>
              <button data-act="walk">ì‚°ì±…í•˜ê¸°</button>
              <button data-act="date" disabled>ë°ì´íŠ¸(L3)</button>
            </div>
          </div>
        </div>
        <div class="row-slim">
          <span class="pill" id="pillRepeat">ì—°ì†ì¹´í…Œê³ ë¦¬ Ã—1.00</span>
          <span class="pill" id="pillStressTier">ìŠ¤íŠ¸ë ˆìŠ¤ ë‹¨ê³„: ì •ìƒ</span>
          <span class="pill" id="pillFlags">ì˜¤ëŠ˜: ìŠˆí¼Ã—</span>
        </div>
      </div>

      <!-- EVENT MODE (sub events / level up / dinner choices) -->
      <div id="eventMode" class="hidden">
        <div id="eventText" class="event-box">ì´ë²¤íŠ¸ í…ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
        <div style="height:8px"></div>
        <div class="btns">
          <button id="btnBack">í–‰ë™ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      </div>

      <!-- DINNER/BATH chooser (auto at evening) -->
      <div id="dinnerMode" class="hidden">
        <div class="event-box">ì €ë…ì‹ì‚¬ ë°©ì‹ì„ ê³ ë¥¼ë˜?
          <br>â€¢ í¸ì˜ì  ë„ì‹œë½ (GLD -8~-12)
          <br>â€¢ ì§ì ‘ ìš”ë¦¬ (ë‹¹ì¼ ìŠˆí¼ ì„ í–‰ í•„ìš”, íš¨ìœ¨ +40%, GLD -10~-18)
          <br>â€¢ ì™¸ì‹ (íœ´ì¼ë§Œ ê°€ëŠ¥, GLD -25~-50)
        </div>
        <div style="height:8px"></div>
        <div class="btns">
          <button data-dinner="conbini">í¸ì˜ì  ë„ì‹œë½</button>
          <button data-dinner="cook" id="btnCook">ì§ì ‘ ìš”ë¦¬</button>
          <button data-dinner="dineout" id="btnDineOut">ì™¸ì‹(íœ´ì¼)</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer-reset" style="padding:8px 14px;text-align:center;font-size:11px;color:var(--muted);position:fixed;left:0;right:0;bottom:0;background:var(--panel);border-top:1px solid #1f2330;z-index:20">
    <button id="btnReset" style="font:inherit;font-size:11px;color:inherit;background:none;border:none;text-decoration:underline;opacity:.7;cursor:pointer">ë‹¤ì‹œì‹œì‘</button>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ---------------------- Core Game State ----------------------
    const S = {
      day:1, slot:0, // 0 ì•„ì¹¨, 1 ë‚®, 2 ì €ë…
      level:1,
      stats:{AFF:0,TRU:0,MOT:0,MOOD:0,STR:0,STM:100,GLD:100},
      flags:{visitedSuper:false, lastCategory:null, repeatCount:0, forcedRest:0, lastTwoActs:[], bathsaltReady:0, labels:{} },
      inventory:{}, // id -> {name, charges|null}
      completedByLevel:{1:new Set(),2:new Set(),3:new Set(),4:new Set(),5:new Set(),6:new Set(),7:new Set()},
      rng:{crit:0.08,fumble:0.06,swing:0.2},
      dayAff:0,
      maxRepeatCountToday:0,
      daysLowRepeatStreak:0,
      daysStrBelow40Streak:0
    };

    const LEVEL_THRESH={2:35,3:85,4:150,5:230,6:320,7:420,8:540}; // AFF ë¬¸í„±

    // Actions DB (base deltas before multipliers): AFF,TRU,MOT,MOOD,STR,STM,GLD
    const ACT = {
      talk:{name:'ëŒ€í™”í•˜ê¸°', cat:'ë§ê±¸ê¸°', base:[3,2,0,0.5,-2,-5,0], img:'/img/action_talk.png', tags:{}},
      play:{name:'ë†€ì•„ì£¼ê¸°', cat:'ë§ê±¸ê¸°', base:[5,0,3,1,-1,-12,randBetween(-3,0)], img:'/img/action_play.png', tags:{repeatMotDrop:true}},
      study:{name:'ê³µë¶€í•˜ê¸°', cat:'ë§ê±¸ê¸°', base:[0,2,8,-0.5,6,-15,0], img:'/img/action_study.png', tags:{study:true}},
      pet:{name:'ì“°ë‹¤ë“¬ê¸°', cat:'ìŠ¤í‚¨ì‹­', base:[4,2,-2,1,-6,-4,0], img:'/img/action_pet.png', tags:{affection:true, gatedLevel:2}},
      hug:{name:'ê»´ì•ˆê¸°', cat:'ìŠ¤í‚¨ì‹­', base:[7,3,-3,1.2,-10,-6,0], img:'/img/action_hug.png', tags:{affection:true, gatedLevel:4}},
      kiss:{name:'í‚¤ìŠ¤', cat:'ìŠ¤í‚¨ì‹­', base:[11,3,-5,1.5,-8,-6,0], img:'/img/action_kiss.png', tags:{affection:true, gatedLevel:5}},
      rest:{name:'ê·¸ëƒ¥ ì‰¬ê¸°', cat:'íœ´ì‹', base:[0,0,0,0.5,-12,16,0], img:'/img/action_rest.png', tags:{care:true}},
      tea:{name:'ì°¨ ë§ˆì‹œê¸°', cat:'íœ´ì‹', base:[1,1,0,0.7,-8,10,randBetween(-5,-2)], img:'/img/action_tea.png', tags:{care:true, tea:true}},
      sleep:{name:'ì ìê¸°', cat:'íœ´ì‹', base:[0,0,2,0,-15,60,0], img:'/img/action_sleep.png', tags:{sleep:true}},
      sleepTogether:{name:'í•¨ê»˜ ìê¸°', cat:'íœ´ì‹', base:[4,3,4,1,-20,70,0], img:'/img/action_sleeptogether.png', tags:{affection:true, sleep:true, gatedLevel:6}},
      bathTogether:{name:'í•¨ê»˜ ëª©ìš•', cat:'íœ´ì‹', base:[6,4,2,1.3,-18,12,randBetween(-3,0)], img:'/img/action_bathtogether.png', tags:{affection:true, bath:true, gatedLevel:7}},
      work:{name:'ì¼í•˜ê¸°', cat:'ì¼/ì‡¼í•‘', base:[0,1,-2,-0.5,12,-18,randBetween(25,40)], img:'/img/action_work.png', tags:{work:true}},
      super:{name:'ìŠˆí¼', cat:'ì¼/ì‡¼í•‘', base:[0,0,0,0,-2,-6,randBetween(-20,-8)], img:'/img/action_super.png', tags:{shop:'super'}},
      book:{name:'ì„œì ', cat:'ì¼/ì‡¼í•‘', base:[0,0,0,0,-1,-4,randBetween(-20,-12)], img:'/img/action_book.png', tags:{shop:'book'}},
      pharm:{name:'ì•½êµ­', cat:'ì¼/ì‡¼í•‘', base:[0,0,0,0,-15,0,randBetween(-35,-25)], img:'/img/action_pharm.png', tags:{shop:'pharm'}},
      volunteer:{name:'ë´‰ì‚¬í™œë™', cat:'íœ´ì¼', base:[0,4,10,0.5,10,-20,0], img:'/img/action_volunteer.png', tags:{holiday:true}},
      walk:{name:'ì‚°ì±…', cat:'íœ´ì¼', base:[3,1,2,0.8,-6,-10,0], img:'/img/action_walk.png', tags:{holiday:true}},
      date:{name:'ë°ì´íŠ¸', cat:'íœ´ì¼', base:[10,4,3,1.2,-6,-14,randBetween(-60,-25)], img:'/img/action_date.png', tags:{holiday:true, gatedLevel:3}},
    };

    // Shop items (subset; charges=null means permanent)
    const SHOP = {
      super:[
        {id:'recipe', name:'ë ˆì‹œí”¼ í‚¤íŠ¸', price:18, charges:1, note:"ë§›ìˆëŠ” ìˆ˜ì œ ìš”ë¦¬ ë ˆì‹œí”¼"},
        {id:'bathsalt', name:'ì…ìš•ì œ', price:14, charges:1, note:'ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í’€ë¦¬ëŠ” ì…ìš•ì œ'},
        {id:'tealeaf', name:'ì°¨ì(ë¸”ë Œë“œ)', price:10, charges:3, note:'ë§ˆì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ” ì°¨'},
        {id:'bento', name:'ë³´ì˜¨ ë„ì‹œë½', price:16, charges:1, note:'ì˜ì–‘ì´ ê°€ë“í•œ ë„ì‹œë½'},
        {id:'blanket', name:'ë‹´ìš”', price:20, charges:null, note:'ë”°ëœ»í•œ ë‹´ìš”'}
      ],
      book:[
        {id:'tech', name:'ê¸°ìˆ ì„œ', price:20, charges:null, note:'ê³µë¶€ì— ë„ì›€ì´ ë˜ëŠ” ì±…'},
        {id:'exam', name:'ìˆ˜í—˜ì„œ', price:22, charges:2, note:'ê³µë¶€ì— ë„ì›€ì´ ë˜ëŠ” ì±…'},
        {id:'cookbook', name:'ìš”ë¦¬ì±…', price:16, charges:null, note:'ìš”ë¦¬ê³ ìˆ˜ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ê¸°ì´ˆì„œ'},
        {id:'zodiac', name:'ë³„ìë¦¬ ê°€ì´ë“œ', price:14, charges:null, note:'ë°¤í•˜ëŠ˜ì„ ìˆ˜ë†“ëŠ” ì•„ë¦„ë‹¤ìš´ ê·¸ë¦¼'},
        {id:'film', name:'ì‚¬ì§„í•„ë¦„', price:12, charges:3, note:'í•„ë¦„ì¹´ë©”ë¼ìš© ì‚¬ì§„ í•„ë¦„'},
        {id:'music', name:'ìŒë°˜/í”Œë ˆì´ë¦¬ìŠ¤íŠ¸', price:12, charges:3, note:'ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ” ìŒì•…'},
        {id:'movie', name:'ì˜í™” ì˜ˆë§¤ê¶Œ', price:24, charges:1, note:'ì˜í™”ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” í‹°ì¼“'},
        {id:'ring', name:'ë°˜ì§€', price:500, charges:null, note:'ì„¸ìƒì—ì„œ ê°€ì¥ íŠ¹ë³„í•œ ì‚¬ëŒì—ê²Œ ì£¼ëŠ” ê²ƒ'}
      ],
      pharm:[
        {id:'antidote', name:'í•´ë…ì œ', price:26, charges:1, note:'ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤„ì—¬ì£¼ëŠ” ì•½'},
        {id:'calm', name:'ì§„ì •íŒ©', price:18, charges:1, note:'ê¸°ë¶„ì´ ì§„ì •ë˜ëŠ” ë§ˆìŠ¤í¬íŒ©'}
      ]
    };

    // Sub-events (L2 only for sample; extend similarly)
    const EVENTS = [

{id:'L2_MOT40_Tech_Study', level:2, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:40}}, items:['tech'], sequence:['study']},
 reward:{TRU:2, MOT:3}},
{id:'L2_STR20_Antidote_Use', level:2, type:'sub', once:true,
 trigger:{stats:{STR:{gte:20}}, items:['antidote'], sequence:['use_antidote']},
 reward:{STR:-20, TRU:2}},
{id:'L2_MOOD0_Tea_Talk', level:2, type:'sub', once:true,
 trigger:{stats:{MOOD:{gte:0}}, items:['tealeaf'], sequence:['tea','talk']},
 reward:{AFF:2, TRU:1}},
{id:'L2_MOT30_Recipe_Cook', level:2, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:30}}, items:['recipe'], sequence:['dinner_cook']}, reward:{AFF:2, MOOD:0.5}},
{id:'L2_TRU5_Talkx2', level:2, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:5}}, counter:{talk:2}}, reward:{TRU:2}},
{id:'L2_MOODneg_Walk', level:2, type:'sub', once:true,
 trigger:{stats:{MOOD:{lt:0}}, sequence:['walk']}, reward:{MOOD:1, AFF:1}},
{id:'L2_STR30_Rest', level:2, type:'sub', once:true,
 trigger:{stats:{STR:{gte:30}}, sequence:['rest']}, reward:{STR:-12, BUFF:{nextPetCrit:+0.10}}},
{id:'L2_STM40_TeaBeforeSleep', level:2, type:'sub', once:true,
 trigger:{stats:{STM:{lte:40}}, sequence:['tea','sleep']}, reward:{STM:+10, MOOD:+0.3}},
{id:'L2_GLD20_Bento_Play_Cook', level:2, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:20}}, items:['bento'], sequence:['play','dinner_cook']}, reward:{AFF:2, MOT:2}},
{id:'L2_Distinct3Cats', level:2, type:'sub', once:true,
 trigger:{meta:{threeDistinctCats:true}}, reward:{TRU:2}},
{id:'L2_MOT50_Study2in3', level:2, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:50}}, meta:{study2in3:true}}, reward:{TRU:2}}
,

{id:'L3_Movie_Date', level:3, type:'sub', once:true,
 trigger:{stats:{}, items:['movie'], sequence:['date']}, reward:{AFF:3, TRU:1}},
{id:'L3_MOT60_Tech_Study2', level:3, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:60}}, items:['tech'], counter:{study:2}}, reward:{TRU:3, MOT:4}},
{id:'L3_STR30_Tea_Talk', level:3, type:'sub', once:true,
 trigger:{stats:{STR:{gte:30}}, items:['tealeaf'], sequence:['tea','talk']}, reward:{AFF:2, TRU:2}},
{id:'L3_Walkx2', level:3, type:'sub', once:true,
 trigger:{counter:{walk:2}}, reward:{MOOD:1}},
{id:'L3_Recipe_Super_Cook', level:3, type:'sub', once:true,
 trigger:{items:['recipe'], sequence:['dinner_cook']}, reward:{AFF:3, TRU:1}},
{id:'L3_MoodNeg_Play_Rest', level:3, type:'sub', once:true,
 trigger:{stats:{MOOD:{lt:0}}, sequence:['play','rest']}, reward:{MOOD:1.2, STR:-8}},
{id:'L3_TRU15_Talk3', level:3, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:15}}, counter:{talk:3}}, reward:{TRU:3}},
{id:'L3_GLD50_DineOut', level:3, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:50}}, sequence:['dinner_dineout']}, reward:{AFF:2}},
{id:'L3_STR35_Bath_Calm', level:3, type:'sub', once:true,
 trigger:{stats:{STR:{gte:35}}, items:['calm'], sequence:['bath','use_calm']}, reward:{STR:-10, MOOD:+0.5}},
{id:'L3_STM30_Tea_Sleep', level:3, type:'sub', once:true,
 trigger:{stats:{STM:{lte:30}}, sequence:['tea','sleep']}, reward:{STM:10, MOT:3}},
{id:'L3_NoRepeatCats', level:3, type:'sub', once:true,
 trigger:{meta:{noRepeat:true}}, reward:{TRU:2}}
,

{id:'L4_Blanket_Rest_Hug', level:4, type:'sub', once:true,
 trigger:{stats:{STR:{gte:30}}, items:[], sequence:['rest','hug']}, reward:{AFF:3, STR:-8}},
{id:'L4_MOT65_Exam_Study2', level:4, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:65}}, items:['exam'], counter:{study:2}}, reward:{TRU:3, MOT:4}},
{id:'L4_Film_Play', level:4, type:'sub', once:true,
 trigger:{items:['film'], sequence:['play']}, reward:{AFF:2}},
{id:'L4_TRU25_TalkTalkPet', level:4, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:25}}, sequence:['talk','talk','pet']}, reward:{TRU:3, AFF:2}},
{id:'L4_Recipe_Cook2', level:4, type:'sub', once:true,
 trigger:{items:['recipe'], counter:{dinner_cook:2}}, reward:{AFF:3}},
{id:'L4_Antidote_Use_WalkBuff', level:4, type:'sub', once:true,
 trigger:{stats:{STR:{gte:40}}, items:['antidote'], sequence:['use_antidote']}, reward:{STR:-25, BUFF:{nextWalkMood:0.5}}},
{id:'L4_MoodNeg_Walk_Tea', level:4, type:'sub', once:true,
 trigger:{stats:{MOOD:{lt:0}}, sequence:['walk','tea']}, reward:{MOOD:1.2, TRU:1}},
{id:'L4_MixedStudyWork3', level:4, type:'sub', once:true,
 trigger:{meta:{mixedSW3:true}}, reward:{MOT:5, TRU:2}},
{id:'L4_GLD80_DineOut', level:4, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:80}}, sequence:['dinner_dineout']}, reward:{AFF:3, TRU:1}},
{id:'L4_STM25_SleepNow', level:4, type:'sub', once:true,
 trigger:{stats:{STM:{lte:25}}, sequence:['sleep']}, reward:{MOOD:0.5, STR:-5}},
{id:'L4_TodayAff16Plus', level:4, type:'sub', once:true,
 trigger:{meta:{todayAff16:true}}, reward:{MOOD:1, STR:-10}}
,

{id:'L5_Zodiac_Night_WalkTalk', level:5, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:40}}, items:['zodiac'], sequence:['walk','talk'], time:'evening'}, reward:{AFF:2}},
{id:'L5_MOT70_Tech_Study3', level:5, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:70}}, items:['tech'], counter:{study:3}}, reward:{TRU:4}},
{id:'L5_STR35_Tea_Kiss', level:5, type:'sub', once:true,
 trigger:{stats:{STR:{gte:35}}, items:['tealeaf'], sequence:['tea','kiss']}, reward:{AFF:4, STR:-8}},
{id:'L5_Film_Play_Photo', level:5, type:'sub', once:true,
 trigger:{items:['film'], sequence:['play']}, reward:{AFF:3}},
{id:'L5_Recipe_Cook_Kiss', level:5, type:'sub', once:true,
 trigger:{items:['recipe'], sequence:['dinner_cook','kiss']}, reward:{TRU:2}},
{id:'L5_Movie_Date', level:5, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:60}}, items:['movie'], sequence:['date']}, reward:{AFF:3}},
{id:'L5_StrBelow40_3Days', level:5, type:'sub', once:true,
 trigger:{meta:{strBelow40Streak:3}}, reward:{TRU:3}},
{id:'L5_STM40_Rest_Kiss', level:5, type:'sub', once:true,
 trigger:{stats:{STM:{lte:40}}, sequence:['rest','kiss']}, reward:{AFF:3}},
{id:'L5_TRU45_Bath_Calm', level:5, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:45}}, items:['calm'], sequence:['bath','use_calm']}, reward:{AFF:3, STR:-8}},
{id:'L5_MoodNeg_Walkx2', level:5, type:'sub', once:true,
 trigger:{stats:{MOOD:{lt:0}}, counter:{walk:2}}, reward:{MOOD:1.5, AFF:2}},
{id:'L5_RepeatDiscipline5Days', level:5, type:'sub', once:true,
 trigger:{meta:{lowRepeatStreak:5}}, reward:{TRU:2}}
,

{id:'L6_TRU55_Blanket_SleepTogether', level:6, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:55}}, items:['blanket'], sequence:['rest','sleepTogether']}, reward:{TRU:3, MOOD:0.5}},
{id:'L6_MOT75_Exam_Study2', level:6, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:75}}, items:['exam'], counter:{study:2}}, reward:{TRU:3, MOT:4}},
{id:'L6_STR30_Antidote_Bath', level:6, type:'sub', once:true,
 trigger:{stats:{STR:{gte:30}}, items:['antidote'], sequence:['use_antidote','bath']}, reward:{STR:-25}},
{id:'L6_Mood1_Music_Lullaby', level:6, type:'sub', once:true,
 trigger:{stats:{MOOD:{gte:1}}, items:['music'], sequence:['play','sleepTogether']}, reward:{}},
{id:'L6_Recipe_Cook_SleepTogether', level:6, type:'sub', once:true,
 trigger:{items:['recipe'], sequence:['dinner_cook','sleepTogether']}, reward:{AFF:3}},
{id:'L6_GLD90_DineOut', level:6, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:90}}, sequence:['dinner_dineout']}, reward:{TRU:3}},
{id:'L6_STM35_Tea_Sleep', level:6, type:'sub', once:true,
 trigger:{stats:{STM:{lte:35}}, sequence:['tea','sleep']}, reward:{MOT:4}},
{id:'L6_StrBelow40_5Days', level:6, type:'sub', once:true,
 trigger:{meta:{strBelow40Streak:5}}, reward:{TRU:4}},
{id:'L6_TRU60_TalkTalkPet', level:6, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:60}}, sequence:['talk','talk','pet']}, reward:{TRU:3, AFF:2}},
{id:'L6_MoodNeg_Walk_Rest', level:6, type:'sub', once:true,
 trigger:{stats:{MOOD:{lt:0}}, sequence:['walk','rest']}, reward:{MOOD:1.5, STR:-10}},
{id:'L6_LowRepeat4Days', level:6, type:'sub', once:true,
 trigger:{meta:{lowRepeatStreak:4}}, reward:{TRU:3}}
,

{id:'L7_BathTogether_with_Bathsalt', level:7, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:0}}, items:['bathsalt'], sequence:['bathTogether']}, reward:{AFF:3}, note:'ë‹¤ìŒ 1ì¹¸ í¬ë¦¬í‹°ì»¬+10%ëŠ” ì—”ì§„ ë‹¨ìˆœí™”ë¡œ ìƒëµ'},
{id:'L7_MOT80_Tech_Study3', level:7, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:80}}, items:['tech'], counter:{study:3}}, reward:{TRU:4, MOT:5}},
{id:'L7_Bath_Calm_Plus', level:7, type:'sub', once:true,
 trigger:{stats:{STR:{gte:35}}, items:['calm'], sequence:['bath','use_calm']}, reward:{STR:-15, MOOD:0.8}},
{id:'L7_Mood1_Music_Bath_Play', level:7, type:'sub', once:true,
 trigger:{stats:{MOOD:{gte:1}}, items:['music'], sequence:['bath','play']}, reward:{AFF:3, STR:-10}},
{id:'L7_Recipe_Cook2', level:7, type:'sub', once:true,
 trigger:{items:['recipe'], counter:{dinner_cook:2}}, reward:{AFF:3, TRU:1}},
{id:'L7_GLD120_DineOut', level:7, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:120}}, sequence:['dinner_dineout']}, reward:{AFF:4, TRU:2}},
{id:'L7_TRU70_Blanket_Hug', level:7, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:70}}, items:['blanket'], sequence:['rest','hug']}, reward:{AFF:3}},
{id:'L7_STM30_Tea_Sleep', level:7, type:'sub', once:true,
 trigger:{stats:{STM:{lte:30}}, sequence:['tea','sleep']}, reward:{STR:-5, MOT:3}},
{id:'L7_StrBelow40_6Days', level:7, type:'sub', once:true,
 trigger:{meta:{strBelow40Streak:6}}, reward:{TRU:5}},
{id:'L7_MoodNeg_Walk3', level:7, type:'sub', once:true,
 trigger:{stats:{MOOD:{lt:0}}, counter:{walk:3}}, reward:{MOOD:2, TRU:2}},
{id:'L7_VeryLowRepeat5Days', level:7, type:'sub', once:true,
 trigger:{meta:{lowRepeatStreak:5}}, reward:{TRU:4}}
,

{id:'L8_DeepTalk_RingLabel', level:8, type:'sub', once:true,
 trigger:{items:['zodiac'], counter:{walk:2}}, reward:{LABEL:'ringBuy'}},

{id:'L8_TRU80_Ring_Talk', level:8, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:80}}, items:['ring'], sequence:['talk']}, reward:{TRU:100}},
{id:'L8_MOT85_TechExam_Study4', level:8, type:'sub', once:true,
 trigger:{stats:{MOT:{gte:85}}, items:['tech','exam'], counter:{study:4}}, reward:{TRU:5, MOT:6}},
{id:'L8_STR0to40_Bathsalt_Bath_Tea', level:8, type:'sub', once:true,
 trigger:{stats:{STR:{lte:40}}, items:['bathsalt'], sequence:['bathTogether','tea']}, reward:{TRU:3, AFF:3}},
{id:'L8_Mood1p5_Film_Play', level:8, type:'sub', once:true,
 trigger:{stats:{MOOD:{gte:1}}, items:['film'], sequence:['play']}, reward:{AFF:4}},
{id:'L8_Recipe_Bento_Cook_Midnight', level:8, type:'sub', once:true,
 trigger:{items:['recipe','bento'], sequence:['dinner_cook']}, reward:{TRU:3, MOOD:0.5}},
{id:'L8_GLD150_DineOut_Special', level:8, type:'sub', once:true,
 trigger:{stats:{GLD:{gte:150}}, sequence:['dinner_dineout']}, reward:{TRU:3}},
{id:'L8_TRU85_Blanket_SleepTogether', level:8, type:'sub', once:true,
 trigger:{stats:{TRU:{gte:85}}, items:['blanket'], sequence:['rest','sleepTogether']}, reward:{TRU:3}},
{id:'L8_STM35_Walk_Sleep', level:8, type:'sub', once:true,
 trigger:{stats:{STM:{lte:35}}, sequence:['walk','sleep']}, reward:{STR:-5, MOT:4}},
{id:'L8_StrBelow40_7Days_Mood1', level:8, type:'sub', once:true,
 trigger:{meta:{strBelow40Streak:7, moodAtLeast:1}}, reward:{TRU:6}},
{id:'L8_LowRepeat5Days_Plus', level:8, type:'sub', once:true,
 trigger:{meta:{lowRepeatStreak:5}}, reward:{TRU:4, AFF:2}}

    ];

  // --- Inlined texts from script.zip ---
  const TEXTS = {"events": {"L2_Distinct3Cats": "í•˜ë£¨ ë™ì•ˆ ëŒ€í™”, íœ´ì‹, ì‡¼í•‘ ë“±\në‹¤ì±„ë¡œìš´ í™œë™ì„ í•¨ê»˜í•˜ë©°\nì§€ë£¨í•  í‹ˆ ì—†ëŠ” í•˜ë£¨ë¥¼ ë³´ëƒˆë‹¤.", "L2_GLD20_Bento_Play_Cook": "í•¨ê»˜ ì‹ ë‚˜ê²Œ ë†€ê³  ë‚œ í›„\në¯¸ë¦¬ ì‚¬ë‘” ë³´ì˜¨ ë„ì‹œë½ í†µì— ì§ì ‘ ë§Œë“  ìš”ë¦¬ë¥¼ ë‹´ì•„ì£¼ì—ˆë‹¤.\nê·¸ë…€ëŠ” ì˜¤ëŠ˜ í•˜ë£¨ì— ë§Œì¡±í•œ ê²ƒ ê°™ì•˜ê³ , \nê·¸ëŸ° ê·¸ë…€ë¥¼ ë³´ëŠ” ë‹¹ì‹ ë„ ê¸°ë¶„ì´ ì¢‹ì•˜ë‹¤.", "L2_MOOD0_Tea_Talk": "ë‚ ì”¨ ì¢‹ì€ ë‚ ,\ní•¨ê»˜ ì°¨ë¥¼ ë§ˆì‹œë©° í¸ì•ˆí•œ ë¶„ìœ„ê¸°ì—ì„œ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ì—ˆë‹¤.\nì†Œì†Œí•˜ê³  í‰ë²”í•œ ì¼ìƒì„ ì„œë¡œ ê³µìœ í–ˆë‹¤.", "L2_MOODneg_Walk": "ê·¸ë…€ì˜ ê¸°ë¶„ì´ ì–´ë”˜ê°€ ë‹µë‹µí•˜ê³  ì•ˆ ì¢‹ì•„ë³´ì—¬ì„œ\ní•¨ê»˜ ì‚°ì±…í•˜ë©° ê¸°ë¶„ ì „í™˜ì„ ì‹œì¼œì£¼ì—ˆë‹¤.\nê·€ê°€í•œ í›„ ê·¸ë…€ í‘œì •ì„ ë³´ë‹ˆ ê¸°ë¶„ì´ í’€ì–´ì§„ ê²ƒ ê°™ì•˜ë‹¤.", "L2_MOT30_Recipe_Cook": "ë‚´ê°€ ìš”ë¦¬í•  ë•Œ ê·¸ë…€ê°€ ë¹¤íˆ ì§€ì¼œë³´ê³  ìˆë˜ ê²ƒì´ ì‹ ê²½ì“°ì—¬\nìŠˆí¼ì—ì„œ ì‚¬ì˜¨ ë ˆì‹œí”¼í‚¤íŠ¸ë¡œ í•¨ê»˜ ì €ë…ì„ ë§Œë“¤ì–´ë³´ì•˜ë‹¤.\nì„œíˆ´ì§€ë§Œ ì¦ê±°ìš´ ìš”ë¦¬ì‹œê°„ì´ì—ˆë‹¤.", "L2_MOT40_Tech_Study": "í•¨ê»˜ ê¸°ìˆ ì„œë¥¼ ë³´ë©° ì—´ì‹¬íˆ ê³µë¶€ë¥¼ í–ˆë‹¤.\nì–´ë ¤ìš´ ë¬¸ì œë¥¼ í•¨ê»˜ í’€ë©´ì„œ ì„œë¡œ ì¡°ê¸ˆì€ ê°€ê¹Œì›Œì§„ ê¸°ë¶„ì´ ë“¤ì—ˆë‹¤.", "L2_MOT50_Study2in3": "ê·¸ë…€ê°€ ê³µë¶€ë¥¼ í•˜ê³  ì‹¶ì–´í•´ì„œ\nê·¸ ëª¨ìŠµì´ ëŒ€ê²¬í•œ ë‹¹ì‹ ì€\nê³ì—ì„œ ì§‘ì¤‘ì ìœ¼ë¡œ ê·¸ë…€ì˜ ê³µë¶€ë¥¼ ë„ì™€ì¤¬ë‹¤.", "L2_STM40_TeaBeforeSleep": "ê·¸ë…€ê°€ í”¼ê³¤í•´ë³´ì—¬ì„œ ë”°ëœ»í•œ ì°¨ë¥¼ ë“ì—¬ì£¼ê³ \ní¸ì•ˆíˆ ì ë“¤ ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì—ˆë‹¤.\nì ë“  ê·¸ë…€ì˜ ì–¼êµ´ì€  ë„ˆë¬´ ì‚¬ë‘ìŠ¤ëŸ¬ì›Œì„œ ë¬´ì‹¬ì½” ê³„ì† ë°”ë¼ë³´ê²Œ ë˜ì—ˆë‹¤.", "L2_STR20_Antidote_Use": "ê·¸ë…€ê°€ ë§ì´ í”¼ê³¤í•˜ê³  ì§€ì¹œ ê²ƒ ê°™ì•„ì„œ,\në‹¹ì‹ ì€ ê·¸ë…€ì—ê²Œ í”¼ë¡œíšŒë³µì œë¥¼ ê±´ë‚´ì£¼ë©° ê±±ì •í•´ì£¼ì—ˆë‹¤. \nê·¸ë…€ëŠ” ë‹¹ì‹ ì˜ ë°°ë ¤ì— ê°ë™í•œ ê²ƒ ê°™ì•˜ë‹¤.", "L2_STR30_Rest": "ì•„ì§ ê·¸ë…€ê°€ ë§ˆìŒì„ ì—´ì§€ ì•Šì€ ê²ƒ ê°™ì•„ì„œ\nì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šê³  í¸ì•ˆíˆ ì‰´ ìˆ˜ ìˆëŠ” ì‹œê°„ì„ ë§ˆë ¨í•´ì£¼ì—ˆë‹¤.\në•Œë¡  ì±™ê²¨ì£¼ëŠ” ê²ƒë³´ë‹¤ ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ëŠ”ê²Œ ë” ë‚˜ì„ ë•Œë„ ìˆë‹¤.", "L2_TRU5_Talkx2": "ë‹¹ì‹ ì€ ê·¸ë…€ì—ê²Œ ì™œ ê·¸ë‚  ì§‘ ì•ì— ì“°ëŸ¬ì ¸ ìˆì—ˆëŠ”ì§€ ë¬¼ì–´ë³´ì•˜ë‹¤.\nê·¸ë…€ëŠ” ê³ ê°œë¥¼ ìˆ™ì´ê³  ì¡°ìš©íˆ ë§í–ˆë‹¤.\nâ€œâ€¦ì•„ë¬´ ë°ë„ ê°ˆ ìˆ˜ ì—†ì–´ì„œâ€¦ ì—¬ê¸°ê°€ ë§ˆì§€ë§‰ì¼ ê²ƒ ê°™ì•˜ì–´.â€\nê·¸ë…€ì˜ ë§íˆ¬ì—”, ì´ìƒí•˜ë¦¬ë§Œì¹˜ ì²´ë…ê³¼ ì˜¤ë˜ëœ í”¼ë¡œê°€ ë¬»ì–´ ìˆì—ˆë‹¤.\në§í•˜ê³  ì‹¶ì§€ ì•Šì€ ëˆˆì¹˜ì—, ë‹¹ì‹ ì€ ë” ë¬»ì§€ ì•Šê¸°ë¡œ í–ˆë‹¤.", "L3_GLD50_DineOut": "ê°€ë”ì€ íŠ¹ë³„í•œ ê¸°ë¶„ì„ ë‚´ê¸° ìœ„í•´ ê·¼ì‚¬í•œ ë ˆìŠ¤í† ë‘ì—ì„œ ì™¸ì‹ì„ í–ˆë‹¤.\ní‰ì†Œì™€ ë‹¤ë¥¸ ë¶„ìœ„ê¸°ì—ì„œ ì¦ê¸°ëŠ” ì €ë….", "L3_MoodNeg_Play_Rest": "ìš°ìš¸í•´í•˜ëŠ” ê·¸ë…€ì˜ ê¸°ë¶„ì„ í’€ì–´ì£¼ê¸° ìœ„í•´ í•¨ê»˜ ë†€ì•„ì¤€ ë’¤,\ní¸ì•ˆí•˜ê²Œ ì‰´ ìˆ˜ ìˆë„ë¡ ë°°ë ¤í•´ì£¼ì—ˆë‹¤.", "L3_MOT60_Tech_Study2": "ê·¸ë…€ëŠ” ê³µë¶€ì— í‘¹ ë¹ ì§„ ë“¯ í–ˆë‹¤.\në‹¹ì‹ ì€ ì˜†ì—ì„œ ê·¸ë…€ì˜ ê³µë¶€ë¥¼ ê³„ì† ë„ì™€ì¤¬ë‹¤.", "L3_Movie_Date": "ì„œì ì—ì„œ êµ¬ë§¤í•œ ì˜í™” ì˜ˆë§¤ê¶Œìœ¼ë¡œ í•¨ê»˜ ì˜í™”ê´€ ë°ì´íŠ¸ë¥¼ í–ˆë‹¤.\në°ì´íŠ¸ì˜ ì„¤ë ˜ì´ ê°€ë“í•œ ìˆœê°„.", "L3_NoRepeatCats": "ë§¤ë²ˆ ìƒˆë¡œìš´ í™œë™ì„ ê³„íší•˜ë©° ë§Œë‚¨ì´ ë‹¨ì¡°ë¡œì›Œì§€ì§€ ì•Šë„ë¡ ë…¸ë ¥í–ˆë‹¤.\në‹¹ì‹ ì˜ ë…¸ë ¥ì— ê·¸ë…€ë„ ì¦ê±°ì›Œí•˜ëŠ” ê²ƒ ê°™ì•˜ë‹¤.", "L3_Recipe_Super_Cook": "í•¨ê»˜ ëª‡ ë²ˆ ìš”ë¦¬ë¥¼ í•˜ë‹¤ë³´ë‹ˆ\nì´ì œëŠ” ê·¸ë…€ì˜ ìš”ë¦¬ë„ ì œë²• ëŠ¥ìˆ™í•´ì¡Œë‹¤.\ní•¨ê»˜ ìš”ë¦¬ë¥¼ í•˜ë©° ì¦ê±°ìš´ ì €ë… ì‹ì‚¬ë¥¼ ì¤€ë¹„í•œë‹¤.", "L3_STM30_Tea_Sleep": "ë§ì´ ì§€ì³ ë³´ì´ëŠ” ê·¸ë…€ê°€ ìˆ™ë©´ì„ ì·¨í•  ìˆ˜ ìˆë„ë¡\në”°ëœ»í•œ ì°¨ë¥¼ ëŒ€ì ‘í•˜ê³  ì¬ì›Œì¤¬ë‹¤.", "L3_STR30_Tea_Talk": "ê·¸ë…€ê°€ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ í˜ë“¤ì–´í•˜ëŠ” ëª¨ìŠµì´ ë³´ì˜€ë‹¤.\ní•¨ê»˜ ì°¨ë¥¼ ë§ˆì‹œë©° ê³ ë¯¼ì„ ë“¤ì–´ì£¼ê³  ìœ„ë¡œí•´ì£¼ì—ˆë‹¤.\ní˜ë“  ì¼ì„ í„°ë†“ì•„ì¤˜ì„œ ì´ ì •ë„ë¡œ ë§ˆìŒì„ ì—´ì–´ì¤€ ê²ƒì´ ê¸°ë»¤ë‹¤.", "L3_STR35_Bath_Calm": "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë§ì€ ë‚ ,\nëª©ìš•ì„ ë§ˆì¹œ ê·¸ë…€ì—ê²Œ ì§„ì •íŒ©ì„ í•´ì£¼ë©° í”¼ë¡œë¥¼ í’€ì–´ì£¼ì—ˆë‹¤.\në‹¹ì‹ ì˜ ì„¬ì„¸í•œ ì¼€ì–´ë¥¼ ê·¸ë…€ë„ ì•Œì•„ì£¼ì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤.", "L3_TRU15_Talk3": "ì–´ëŠ ë‚ , ê·¸ë…€ëŠ” ë°¤í•˜ëŠ˜ì„ ì˜¤ë˜ ë°”ë¼ë³´ë”ë‹ˆ,\nâ€œë‚˜ëŠ” ì§€ê¸ˆë„ ê°€ë” í—·ê°ˆë ¤â€¦ ë‚´ê°€ ì°©ê°í•œê±´ ì•„ë‹Œì§€â€¦â€ë¼ê³  ë§í–ˆë‹¤.\në‹¹ì‹ ì€ ê·¸ê²Œ ë¬´ìŠ¨ ëœ»ì¸ì§€ ë¬¼ì—ˆì§€ë§Œ, ê·¸ë…€ëŠ” ê³ ê°œë¥¼ ì €ì—ˆë‹¤.\në§í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ë“¯í•œ. í˜¹ì€, ë§í•´ë´¤ì ì´í•´ë°›ì§€ ëª»í•  ê±°ë¼ëŠ” ë“¯í•œ ëˆˆë¹›ì´ì—ˆë‹¤.", "L3_Walkx2": "íŠ¹ë³„í•œ ëª©ì  ì—†ì´ í•¨ê»˜ ê±·ëŠ” ì‹œê°„ì´ ëŠ˜ì–´ë‚¬ë‹¤.\në‚˜ë€íˆ ê±¸ìœ¼ë©° ë‚˜ëˆ„ëŠ” ëŒ€í™” ì†ì—ì„œ ì„œë¡œì—ê²Œ ë” ìµìˆ™í•´ì§„ë‹¤.", "L4_Antidote_Use_WalkBuff": "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì‹¬í•´ ë³´ì´ëŠ” ìºë¦­í„°ì—ê²Œ í”¼ë¡œíšŒë³µì œë¥¼ ì±™ê²¨ì£¼ê³ ,\nì•½ ê¸°ìš´ì´ ëŒë©´ ê°™ì´ ì‚°ì±…ì´ë¼ë„ ê°€ìê³  ì œì•ˆí•˜ë©° ì„¸ì‹¬í•˜ê²Œ ë³´ì‚´í´ì£¼ì—ˆë‹¤.", "L4_Blanket_Rest_Hug": "ì§€ì³ì„œ ì‰¬ê³  ìˆëŠ” ê·¸ë…€ë¥¼ ë”°ëœ»í•œ ë‹´ìš”ë¡œ ë®ì–´ì¤€ ë’¤,\në§ì—†ì´ ë¶€ë“œëŸ½ê²Œ ê»´ì•ˆì•„ì£¼ì—ˆë‹¤. \nê°™ì€ ìƒ´í‘¸ì™€ ê±‘ì€ ë°”ë””ì›Œì‹œë¥¼ ì“°ê³ ìˆì„ í…ë°ë„\nê·¸ë…€ì˜ ëª¸ì—ì„œ ë‚˜ëŠ” ëƒ„ìƒˆëŠ” ë‹¹ì‹ ì„ ì„¤ë ˆê²Œ í•˜ê¸° ì¶©ë¶„í–ˆë‹¤.\nì ˆëŒ€ í‘ì‹¬ì„ í’ˆê³  ì•ˆëŠ”ê²Œ ì•„ë‹ˆë¼ë©°, ë‹¹ì‹ ì€ ì• ì¨ ìŠ¤ìŠ¤ë¡œë¥¼ ë‹¬ë¬ë‹¤.", "L4_Film_Play": "í•¨ê»˜ ì¦ê²ê²Œ ë…¸ëŠ” ìˆœê°„,\në‹¹ì‹ ì€ í•„ë¦„ ì¹´ë©”ë¼ë¥¼ êº¼ë‚´ ê·¸ ëª¨ìŠµì„ ì‚¬ì§„ìœ¼ë¡œ ë‚¨ê¸´ë‹¤.\në‘˜ë§Œì˜ ì†Œì¤‘í•œ ì¶”ì–µì´ í•œ ì¥ ë” ìŒ“ì´ëŠ” ìˆœê°„.", "L4_GLD80_DineOut": "ëˆì„ ì¡°ê¸ˆ ëª¨ì•„ì„œ í‰ì†Œë³´ë‹¤ ë” ê·¼ì‚¬í•œ ê³³ìœ¼ë¡œ ì™¸ì‹ì„ ê°”ë‹¤.\níŠ¹ë³„í•œ ë‚ ì„ ê¸°ë…í•˜ê±°ë‚˜, ì„œë¡œë¥¼ ê²©ë ¤í•˜ê¸° ìœ„í•œ ë©‹ì§„ ì €ë… ì‹ì‚¬.", "L4_MixedStudyWork3": "ê³µë¶€ì™€ ì¼ì„ ë³‘í–‰í•˜ë©° ë°”ì˜ì§€ë§Œ ì¶©ì‹¤í•œ ë‚˜ë‚ ì„ ë³´ë‚´ê³  ìˆë‹¤.\nì„œë¡œì˜ ì„±ì‹¤í•œ ëª¨ìŠµì„ ë³´ë©° ë¯¸ë˜ì— ëŒ€í•œ ê¸ì •ì ì¸ ë¯¿ìŒì„ ê°–ê²Œ ëœë‹¤", "L4_MoodNeg_Walk_Tea": "ê¸°ë¶„ì´ ê°€ë¼ì•‰ì€ ê·¸ë…€ë¥¼ ë°ë¦¬ê³  ë‚˜ê°€ ì‚°ì±…ìœ¼ë¡œ ë°”ëŒì„ ì¬ê²Œ í•œ ë’¤,\në”°ëœ»í•œ ì°¨ë¥¼ ë§ˆì‹œë©° ë§ˆìŒì„ í’€ì–´ì£¼ì—ˆë‹¤.", "L4_MOT65_Exam_Study2": "ì¤‘ìš”í•œ ì‹œí—˜ì„ ì•ë‘ê³  ê·¸ë…€ì˜ ê³µë¶€ ì˜ìš•ì´ ë§¤ìš° ë†’ë‹¤.\në‹¹ì‹ ì€ ìˆ˜í—˜ì„œë¥¼ êµ¬í•´ í•¨ê»˜ ê³µë¶€í•˜ë©° ë“ ë“ í•œ ì¡°ë ¥ìê°€ ë˜ì–´ì£¼ì—ˆë‹¤.\në•ë¶„ì— ê·¸ë…€ëŠ” ì‹œí—˜ì— í•©ê²©í–ˆë‹¤.", "L4_Recipe_Cook2": "ì´ì „ì— í•¨ê»˜ ìš”ë¦¬í–ˆë˜ ë ˆì‹œí”¼ê°€ ë§ˆìŒì— ë“¤ì—ˆëŠ”ì§€,\në‹¤ì‹œ í•œë²ˆ í•¨ê»˜ ìš”ë¦¬ë¥¼ í•œë‹¤.\nì´ì œëŠ” ì œë²• ì†ë°œì´ ì˜ ë§ëŠ” ì¦ê±°ìš´ ìš”ë¦¬ ì‹œê°„", "L4_STM25_SleepNow": "ë‹¹ì‹ ì˜ ì¦ì€ ê³µë¶€ì™€ ì¼ ë“±ìœ¼ë¡œ ê³¼ë¡œë¡œ ê°ê¸°ì— ê±¸ë ¸ë‹¤.\nì–´ë–»ê²Œ ì¹¨ëŒ€ì— ë“¤ì–´ê°”ëŠ”ì§€ë„ ê¸°ì–µë‚˜ì§€ ì•ŠëŠ”ë‹¤.\nê·¸ë…€ëŠ” ë‹¹ì‹ ì´ ê±±ì •ì´ ë˜ì—ˆëŠ”ì§€ ë¬¼ìˆ˜ê±´ì„ ì˜¬ë¦¬ë©° ê°„í˜¸í•´ì£¼ì—ˆë‹¤.\nì•„í”Œ ë•Œ í˜¼ìê°€ ì•„ë‹ˆë¼ì„œ ë‹¹ì‹ ì€ ê·¸ë…€ì—ê²Œ ê°ì‚¬í•¨ì„ ëŠê¼ˆë‹¤.", "L4_TodayAff16Plus": "ì˜¤ëŠ˜ë”°ë¼ ìœ ë‚œíˆ ì• ì •ì´ ë„˜ì¹˜ëŠ” í•˜ë£¨ë¥¼ ë³´ëƒˆë‹¤.\nì‚¬ì†Œí•œ í–‰ë™ í•˜ë‚˜í•˜ë‚˜ê°€ ì„œë¡œì—ê²Œ í° ê¸°ì¨ì´ ë˜ì—ˆë˜,\níŠ¹ë³„íˆ í–‰ë³µí•œ ë‚ .", "L4_TRU25_TalkTalkPet": "ë˜ ë‹¤ë¥¸ ì–´ëŠ ë‚ , ê·¸ë…€ëŠ” ë§ì„¤ì´ë‹¤ê°€ ì¡°ìš©íˆ ë§í–ˆë‹¤.\në‹¹ì‹ ì€ ê¸°ì–µí•˜ì§€ ëª»í•˜ê² ì§€ë§Œ ê·¸ë…€ëŠ” ì˜ˆì „ë¶€í„° ë‹¹ì‹ ì„ ì•Œê³  ìˆì—ˆë‹¤ê³ .\në‹¹ì‹ ì€ ì–´ë¦¬ë‘¥ì ˆí•´ì„œ ë§ì„ ì‡ì§€ ëª»í–ˆë‹¤.\nê·¸ë…€ëŠ” ê·¸ ë§ì„ ëìœ¼ë¡œ ì•„ë¬´ ì„¤ëª…ë„ ë§ë¶™ì´ì§€ ì•Šì•˜ì§€ë§Œ,\nê·¸ ë§ì€ ë¨¸ë¦¿ì†ì—ì„œ ìê¾¸ ìš¸ë ¤ í¼ì¡Œê³ , ì–´ì©ì§€ ê°€ìŠ´ì´ ì´ìƒí•˜ê²Œ ë‘ê·¼ê±°ë ¸ë‹¤.", "L5_Film_Play_Photo": "ë˜ë‹¤ì‹œ í•¨ê»˜ ë…¸ëŠ” ëª¨ìŠµì„ ì‚¬ì§„ìœ¼ë¡œ ë‚¨ê¸´ë‹¤.\nì°¨ê³¡ì°¨ê³¡ ìŒ“ì—¬ê°€ëŠ” ì‚¬ì§„ë“¤ì²˜ëŸ¼, \nì´ì œ ë‘˜ì˜ ì¶”ì–µë„ ê½¤ ìƒë‹¹í•˜ê²Œ ìŒ“ì—¬ìˆì–´\nìƒê¸° ì‹«ì€ ê²ƒì´ ë˜ì—ˆë‹¤.", "L5_MoodNeg_Walkx2": "ê·¸ë…€ì˜ ê¸°ë¶„ì´ ì¢€ì²˜ëŸ¼ ë‚˜ì•„ì§€ì§€ ì•Šì,\në‹¹ì‹ ì€ ë©°ì¹ ì— ê±¸ì³ í•¨ê»˜ ì‚°ì±…í•˜ë©° ê³ì„ ì§€ì¼œì¤€ë‹¤.\në‹¹ì‹ ì˜ ëˆê¸° ìˆëŠ” ìœ„ë¡œê°€ ê·¸ë…€ì˜ ë§ˆìŒì„ ì›€ì§ì˜€ë‹¤.", "L5_MOT70_Tech_Study3": "ê·¸ë…€ëŠ” ê³µë¶€ë¥¼ ê³„ì† ì—´ì‹¬íˆ í–ˆê³  ì‹œí—˜ê³¼ ìê²©ì¦ë„ í•œ ë‘ê°œ í•©ê²©í•˜ë©°\nê·¸ë…€ì˜ ë™ê¸°ëŠ” ìµœê³ ì¡°ê°€ ë˜ì—ˆë‹¤.\në‹¹ì‹ ì€ ê¸°ìˆ ì„œë¥¼ í™œìš©í•´ ì‹¬ë„ ìˆëŠ” ê³µë¶€ë¥¼ í•¨ê»˜í•˜ë©° íŒŒíŠ¸ë„ˆê°€ ë˜ì–´ì¤¬ë‹¤.", "L5_Movie_Date": "ì´ì œ ì˜í™”ê´€ ë°ì´íŠ¸ëŠ” ë‘˜ë§Œì˜ ì¦ê±°ìš´ ì—°ë¡€í–‰ì‚¬ì²˜ëŸ¼ ë˜ì—ˆë‹¤.\nì–´ë–¤ ì˜í™”ë¥¼ ë³¼ì§€ í•¨ê»˜ ê³ ë¥´ë©° ì„¤ë ˆëŠ” ì‹œê°„ì„ ë³´ë‚¸ë‹¤.", "L5_Recipe_Cook_Kiss": "í•¨ê»˜ ë§›ìˆëŠ” ì €ë…ì„ ë§Œë“¤ì–´ ë¨¹ì€ ë’¤,\nì„¤ê±°ì§€ë¥¼ í•˜ê±°ë‚˜ ì†ŒíŒŒì— ì•‰ì•„ ì‰¬ëŠ” ë“±\ní‰ë²”í•œ ì¼ìƒ ì†ì—ì„œ ë‹¬ì½¤í•œ í‚¤ìŠ¤ë¥¼ ë‚˜ëˆˆë‹¤.\në‹¹ì‹ ì€ ì‹ í˜¼ë¶€ë¶€ ê°™ì€ ëŠë‚Œì´ë¼ê³  ìƒê°í–ˆì§€ë§Œ, \nì… ë°–ìœ¼ë¡œ êº¼ë‚´ì§„ ì•Šì•˜ë‹¤.", "L5_RepeatDiscipline5Days": "ë§¤ì¼ ë‹¤ë¥¸ í™œë™ì„ ê³„íší•˜ë©° ì¼ìƒì´ ì§€ë£¨í•´ì§€ì§€ ì•Šë„ë¡ ë…¸ë ¥í–ˆë‹¤.\nê·¸ë…€ì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë“  í–‰ë™ì´ ë„ˆë¬´ ì¦ê±°ì›Œì„œ,\nìµœëŒ€í•œ ì—¬ëŸ¬ê°€ì§€ ê²½í—˜ì„ í•˜ê³  ì‹¶ì—ˆë‹¤.", "L5_STM40_Rest_Kiss": "í”¼ê³¤í•´ì„œ ì‰¬ê³  ìˆëŠ” ìºë¦­í„°ì˜ ê³ì— ì¡°ìš©íˆ ë‹¤ê°€ê°€,\nì‰¬ëŠ” ê²ƒì„ ë°©í•´í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ ì• ì •ì„ í‘œí˜„í•˜ëŠ” ê°€ë²¼ìš´ í‚¤ìŠ¤ë¥¼ í•´ì¤¬ë‹¤.\nê·¸ë…€ë„ ì‹«ì§€ ì•Šì€ ê²ƒ ê°™ì•˜ë‹¤.", "L5_STR35_Tea_Kiss": "ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì€ ê·¸ë…€ë¥¼ ìœ„í•´ ì°¨ë¥¼ ë“ì—¬ì£¼ë©° ìœ„ë¡œí•˜ê³ ,\në¶„ìœ„ê¸°ê°€ ë¬´ë¥´ìµì ë”°ëœ»í•œ í‚¤ìŠ¤ë¡œ ìœ„ë¡œì˜ ë§ˆìŒì„ ì „í–ˆë‹¤.\nê·¸ë…€ëŠ” ë–¨ì–´ì§€ê¸° ì‹«ì€ ë“¯ ê³„ì† ì•ˆê²¼ê³  \nì´‰ì´‰í•œ ëˆˆìœ¼ë¡œ ê³„ì† í‚¤ìŠ¤ë¥¼ ì¡¸ëë‹¤.\nëë‚œ í›„ì— ì‹œê³„ë¥¼ ë³´ë‹ˆ ì‹œê°„ì´ í•œì°¸ ì§€ë‚˜ìˆì—ˆë‹¤.\n", "L5_StrBelow40_3Days": "ê·¸ë…€ì™€ì˜ ê´€ê³„ëŠ” ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìˆë‹¤.\nì´ ì•ˆì •ì´ ì„œë¡œì—ê²Œ ì¢‹ì€ ì˜í–¥ì„ ì£¼ê³  ìˆë‹¤ê³  ëŠê»´ì¡Œë‹¤.", "L5_TRU45_Bath_Calm": "ëª©ìš• í›„ì˜ ê°€ì¥ í¸ì•ˆí•œ ìƒíƒœì—ì„œ ì§„ì •íŒ©ì„ í•´ì£¼ë©° ì„œë¡œë¥¼ ì¼€ì–´í•´ì£¼ì—ˆë‹¤.", "L5_Zodiac_Night_WalkTalk": "í•¨ê»˜ ì‚°ì±…í•˜ë©° ë³„ìë¦¬ ê°€ì´ë“œë¥¼ ë³´ë©° ë°¤í•˜ëŠ˜ì˜ ë³„ë“¤ì„ ì°¾ì•„ë³¸ë‹¤.\në‚­ë§Œì ì¸ ë¶„ìœ„ê¸° ì†ì—ì„œ ì„œë¡œì˜ ë¯¸ë˜ë¥¼ ì´ì•¼ê¸°í–ˆë‹¤.", "L6_GLD90_DineOut": "ê¸°ë…ì¼ì´ ìˆì–´, í°ë§˜ ë¨¹ê³  ìµœê³ ê¸‰ ë ˆìŠ¤í† ë‘ì—ì„œ ì™¸ì‹ì„ í–ˆë‹¤. ", "L6_LowRepeat4Days": "ë‹¹ì‹ ì€ 4ì¼ì§¸ ìƒˆë¡œìš´ í™œë™ì„ ê³„íší•˜ë©° ê·¸ë…€ì—ê²Œ\nìµœê³ ì˜ ì‹œê°„ë§Œì„ ì„ ë¬¼í•˜ê¸° ìœ„í•´ ë…¸ë ¥í•˜ê³  ìˆë‹¤.\në‹¹ì‹ ì—ê²Œ ìˆì–´ì„œ ê·¸ë…€ëŠ” ì™„ì „íˆ ì†Œì¤‘í•œ ì¡´ì¬ê°€ ë˜ì—ˆë‹¤.", "L6_Mood1_Music_Lullaby": "ê¸°ë¶„ ì¢‹ì€ ë‚ , í•¨ê»˜ ìŒì•…ì„ ë“¤ìœ¼ë©° ë†€ë‹¤ê°€\nê·¸ ìŒì•…ì„ ìì¥ê°€ ì‚¼ì•„ í•¨ê»˜ ì ì´ ë“ ë‹¤.\ní–‰ë³µí•˜ê³  í‰í™”ë¡œìš´ ì¼ìƒì˜ ë‹¨ë©´.", "L6_MoodNeg_Walk_Rest": "ìš°ìš¸í•´í•˜ëŠ” ê·¸ë…€ì˜ ì†ì„ ì¡ê³  ì¡°ìš©í•œ ê³³ì„ ì‚°ì±…í•œ ë’¤,\nì§‘ì— ëŒì•„ì™€ ì•„ë¬´ ìƒê° ì—†ì´ í‘¹ ì‰´ ìˆ˜ ìˆë„ë¡ ëª¨ë“  ê²ƒì„ ë°°ë ¤í•´ì£¼ì—ˆë‹¤.", "L6_MOT75_Exam_Study2": "ê½¤ ì–´ë µë‹¤ê³  ì•Œë ¤ì§„ ì»¤ë‹¤ë€ ì‹œí—˜ì´ ìˆë‹¤.\nì¤‘ìš”í•œ ëª©í‘œë¥¼ í–¥í•œ ê·¸ë…€ì˜ ì—´ì •ì´ ì ˆì •ì— ë‹¬í–ˆë‹¤. \në‹¹ì‹ ì€ ê³ì—ì„œ ëê¹Œì§€ í•¨ê»˜ ë°¤ì„ ìƒˆìš°ë©° ì‘ì›í•œë‹¤.\ní•©ê²©ë¥ ì´ ë§¤ìš° ë‚®ì€ ì‹œí—˜ì´ì—ˆì§€ë§Œ, \nì™ ì§€ ë‹¹ì‹ ì€ ê·¸ë…€ê°€ í•©ê²©í• ê²ƒë§Œ ê°™ì€ ê¸°ë¶„ì´ ë“¤ì—ˆë‹¤.", "L6_Recipe_Cook_SleepTogether": "í•¨ê»˜ ì •ì„±ê» ì €ë…ì„ ë§Œë“¤ì–´ ë¨¹ê³ ,\në’·ì •ë¦¬ë¥¼ ë§ˆì¹œ ë’¤ ìì—°ìŠ¤ëŸ½ê²Œ í•¨ê»˜ ì ìë¦¬ì— ë“¤ì—ˆë‹¤.\në§ˆì¹˜ ë¶€ë¶€ê°€ ëœ ê²ƒ ê°™ì€ ê¸°ë¶„ì´ ë“¤ì—ˆë‹¤.", "L6_STM35_Tea_Sleep": "ëŠ¦ì€ ë°¤ê¹Œì§€ ë¬´ë¦¬í•œ ê·¸ë…€ë¥¼ ìœ„í•´ ë”°ëœ»í•œ ì°¨ë¥¼ ë“ì—¬ì£¼ê³ ,\nì–´ì„œ ì ìë¦¬ì— ë“¤ë¼ë©° ë‹¤ì •í•˜ê²Œ ë“±ì„ ë– ë°€ì–´ì¤¬ë‹¤.", "L6_STR30_Antidote_Bath": "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í’€ì–´ì£¼ê¸° ìœ„í•´ í”¼ë¡œíšŒë³µì œë¥¼ ì±™ê²¨ì¤€ ë’¤,\nì´ì–´ì„œ ë”°ëœ»í•œ ë¬¼ì— ëª©ìš•í•˜ë©°\nëª¸ê³¼ ë§ˆìŒì˜ í”¼ë¡œë¥¼ ì™„ì „íˆ ì”»ì–´ë‚¼ ìˆ˜ ìˆë„ë¡ ë„ì™”ë‹¤.", "L6_StrBelow40_5Days": "ë‹¹ì‹ ì˜ í—Œì‹ ì ì¸ ê´€ë¦¬ ë•ë¶„ì— ê·¸ë…€ëŠ” ë§¤ìš° í–‰ë³µí•œ ì¸ìƒì„ ë³´ë‚´ê³  ìˆë‹¤.\nê·¸ë…€ëŠ” ì–´ëŠë‚  ìª½ì§€ë¡œ ê°ì‚¬ í¸ì§€ë¥¼ ë‚¨ê²¼ë‹¤.\në‹¹ì‹ ê³¼ í•¨ê»˜ ì‚´ ìˆ˜ ìˆëŠ”ê±´ ìµœê³ ì˜ í–‰ìš´ì´ì—ˆë‹¤ê³ .", "L6_TRU55_Blanket_SleepTogether": "ì„œë¡œ ì‰¬ë‹¤ê°€ ìì—°ìŠ¤ëŸ½ê²Œ í•œ ì¹¨ëŒ€ì—ì„œ ì ì´ ë“ ë‹¤.\në”°ëœ»í•œ ë‹´ìš” ì•„ë˜ì—ì„œ ì„œë¡œì˜ ì˜¨ê¸°ë¥¼ ëŠë¼ë©° í‰ì˜¨í•œ ë°¤ì„ ë³´ë‚¸ë‹¤.", "L6_TRU60_TalkTalkPet": "ê·¸ë‚  ë°¤, ê·¸ë…€ëŠ” ë¬¸ë“ ë‹¹ì‹ ì˜ ì†ì„ ê°€ë§Œíˆ ì¡ì•˜ë‹¤.\nê·¸ë¦¬ê³  ì•„ì£¼ ì‘ê³  ë–¨ë¦¬ëŠ” ëª©ì†Œë¦¬ë¡œ ë¬¼ì—ˆë‹¤.\nâ€œë§Œì•½ ë‚´ê°€ ì „ìƒì˜ ì—°ì¸ì„ ë‹¤ì‹œ ë§Œë‚˜ê¸° ìœ„í•´ ìˆ˜ë§ì€ ì¼ë“¤ì„ ê±°ì³ì„œ,\nì´ë ‡ê²Œ í™˜ìƒí•´ì„œ ë§Œë‚˜ê²Œ ëœê±°ë¼ë©´ ë¯¿ì–´ì¤„ ìˆ˜ ìˆì„ê¹Œ?â€\në§ì„ ë§ˆì¹˜ê³  ê·¸ë…€ëŠ” ëˆˆì„ ê°ì•˜ì§€ë§Œ, ëˆˆêº¼í’€ ë„ˆë¨¸ë¡œ ì‘ê²Œ ë¹›ë‚˜ëŠ” ëˆˆë¬¼ì´ ìŠ¤ì³¤ë‹¤.\nê·¸ë…€ì˜ ë§ì€ ë‹¹ì‹  ë§ˆìŒ ì–´ë”˜ê°€ë¥¼ ëœ¨ê²ê²Œ ë¶™ì¡ê³  ë†“ì•„ì£¼ì§€ ì•Šì•˜ë‹¤.", "L7_Bath_Calm_Plus": "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë§ì€ ë‚ ,\nëª©ìš•ìœ¼ë¡œ ê¸´ì¥ì„ í‘¼ ê·¸ë…€ì—ê²Œ ì§„ì •íŒ©ì„ í•´ì£¼ë©°\ní”¼ë¶€ì™€ ë§ˆìŒì„ ë™ì‹œì— ê´€ë¦¬í•´ì£¼ì—ˆë‹¤.", "L7_BathTogether_with_Bathsalt": "ë¯¸ë¦¬ ì¤€ë¹„í•œ í–¥ê¸°ë¡œìš´ ì…ìš•ì œë¥¼ í‘¼ ìš•ì¡°ì—ì„œ\ní•¨ê»˜ ëª©ìš•í•˜ë©° í•˜ë£¨ì˜ í”¼ë¡œë¥¼ ë…¹ì´ê³  ì‚¬ë‘ì„ ì†ì‚­ì˜€ë‹¤.", "L7_GLD120_DineOut": "ì—°ì¸ìœ¼ë¡œì„œ ë©‹ìˆëŠ” ëª¨ìŠµì„ ë³´ì´ê³  ì‹¶ì–´ì„œ\nì¡°ê¸ˆ í° ëˆì„ ë“¤ì—¬ ë¶„ìœ„ê¸° ì¢‹ì€ ì‹ë‹¹ì— ì˜ˆì•½ì„ í–ˆë‹¤.\në‹¹ì‹ ë„ ê·¸ë…€ë„ ì²˜ìŒ ë¨¹ì–´ë³´ëŠ” ìš”ë¦¬ê°€ ê°€ë“í–ˆë‹¤. \nì²˜ìŒì„ í•¨ê»˜ í•  ìˆ˜ ìˆì–´ì„œ ë”ìš± ì¸ìƒê¹Šì—ˆë‹¤.\n\n", "L7_Mood1_Music_Bath_Play": "ê¸°ë¶„ ì¢‹ì€ ë‚ , í•¨ê»˜ ëª©ìš•í•˜ë©° ì¥ë‚œì„ ì¹˜ê³ \në‚˜ì˜¨ ë’¤ì—ë„ ìŒì•…ì„ í‹€ì–´ë†“ê³  ì–´ë¦°ì•„ì´ì²˜ëŸ¼ ìˆœìˆ˜í•˜ê²Œ ë†€ë©°\nì¦ê±°ì›€ì´ ê°€ë“í•œ í•˜ë£¨ë¥¼ ë³´ëƒˆë‹¤.\nê·¸ë…€ì™€ í•¨ê»˜í•  ë•Œë§ˆë‹¤ ì–´ë¦°ì´ì²˜ëŸ¼ ì¦ê±°ì›Œì§€ëŠ” ê±¸ ëŠê¼ˆë‹¤.", "L7_MoodNeg_Walk3": "ê·¸ë…€ê°€ ìš°ìš¸ê°ì— ë¹ ì¡Œì„ ë•Œë§ˆë‹¤,\në‹¹ì‹ ì€ í¬ê¸°í•˜ì§€ ì•Šê³  ê·¸ë…€ì™€ í•¨ê»˜ ì‚°ì±…í•˜ë©° ê³ì„ ì§€ì¼°ë‹¤.\nì–´ë–¤ ì–´ë ¤ì›€ë„ í•¨ê»˜ ê·¹ë³µí•˜ê² ë‹¤ëŠ” ì˜ì§€ì˜ í‘œí˜„ì´ì—ˆë‹¤.", "L7_MOT80_Tech_Study3": "ê·¸ë…€ëŠ” ì´ì œ í•œ ë¶„ì•¼ì˜ ì „ë¬¸ê°€ê°€ ë˜ì—ˆê³ , \nìì‹ ì˜ ê¿ˆì„ í–¥í•´ ë” ì•ìœ¼ë¡œ ë‹¬ë ¤ë‚˜ê°€ê³  ìˆë‹¤.\në‹¹ì‹ ì€ ê·¸ ê¿ˆì„ ì ê·¹ì ìœ¼ë¡œ ì‘ì›í•œë‹¤.\n", "L7_Recipe_Cook2": "ì´ì œ í•¨ê»˜ ìš”ë¦¬í•˜ëŠ” ê²ƒì€ íŠ¹ë³„í•œ ì´ë²¤íŠ¸ê°€ ì•„ë‹Œ,\ní–‰ë³µí•œ ì¼ìƒì´ ë˜ì—ˆë‹¤.\nëŠ¥ìˆ™í•˜ê²Œ ì €ë…ì„ ì¤€ë¹„í•˜ë©° ì„œë¡œì˜ í•˜ë£¨ë¥¼ ë¬»ëŠ”ë‹¤.", "L7_STM30_Tea_Sleep": "í”¼ê³¤ì— ì§€ì¹œ ê·¸ë…€ë¥¼ ì¬ìš°ê¸° ìœ„í•´\nì°¨ë¥¼ ë“ì—¬ì£¼ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµì€\nì´ì œ ìˆ™ë ¨ëœ ê°„í˜¸ì‚¬ë‚˜ ë¶€ëª¨ì²˜ëŸ¼ ëŠ¥ìˆ™í•˜ê³  ë‹¤ì •í•˜ë‹¤.", "L7_StrBelow40_6Days": "", "L7_TRU70_Blanket_Hug": "ì‰¬ê³  ìˆëŠ” ê·¸ë…€ë¥¼ ë‹´ìš”ë¡œ ê°ì‹¸ ì•ˆì•„ì£¼ëŠ” ê²ƒì€\nì´ì œ ë„ˆë¬´ë‚˜ ìì—°ìŠ¤ëŸ¬ìš´ í–‰ë™ì´ë‹¤.\nì„œë¡œëŠ” ì„œë¡œì—ê²Œ ê°€ì¥ í° ì•ˆì‹ì²˜ì´ë‹¤.", "L7_VeryLowRepeat5Days": "ì§€ë£¨í•  í‹ˆ ì—†ëŠ” ë‚˜ë‚ ì„ ë³´ëƒˆë‹¤.\në‘ ì‚¬ëŒì˜ ê´€ê³„ëŠ” í•­ìƒ ìƒˆë¡­ê³  í™œê¸°ê°€ ë„˜ì¹œë‹¤.", "L8_DeepTalk_RingLabel": "ë°¤í•˜ëŠ˜ì„ ë³´ë©° ê·¸ë…€ì™€ ë‚˜ëˆˆ ìˆ˜ë§ì€ ëŒ€í™” ëì—,\në‹¹ì‹ ì€ í™•ì‹ ì„ ì–»ëŠ”ë‹¤.\nê·¸ë…€ì™€ í‰ìƒì„ í•¨ê»˜ í•˜ê³  ì‹¶ë‹¤ê³ .\n", "L8_GLD150_DineOut_Special": "í° ëˆì´ ë“¤ì–´ì˜¬ ì¼ì´ ìƒê²¨ì„œ  í˜¸í™”ë¡­ê²Œ ì™¸ì‹ì„ í–ˆë‹¤.", "L8_LowRepeat5Days_Plus": "ë¯¸ë˜ë¥¼ ì•½ì†í•œ ë’¤ì—ë„ ë‘ ì‚¬ëŒì€ ì—¬ì „íˆ ê´€ê³„ë¥¼ ìƒˆë¡­ê²Œ ê°€ê¾¸ê¸° ìœ„í•´ ë…¸ë ¥í•œë‹¤.\në‹¹ì‹ ê³¼ ê·¸ë…€ì˜ ì‚¬ë‘ì€ ì–¸ì œë‚˜ í˜„ì¬ì§„í–‰í˜•ì´ë‹¤.", "L8_Mood1p5_Film_Play": "ë”í•  ë‚˜ìœ„ ì—†ì´ í–‰ë³µí•œ ë‚ ,\ní•¨ê»˜ ë…¸ëŠ” ëª¨ìŠµì„ ë˜ë‹¤ì‹œ ì‚¬ì§„ìœ¼ë¡œ ë‚¨ê¸´ë‹¤.\nì´ ì‚¬ì§„ì²©ì€ ë‘ ì‚¬ëŒì˜ ì‚¬ë‘ì˜ ì—­ì‚¬ê°€ ë  ê²ƒì´ë‹¤.", "L8_MOT85_TechExam_Study4": "ê·¸ë…€ê°€ ì§€ê¸ˆê¹Œì§€ ì´ë¤„ë‘” ê²ƒì€ ì¶©ë¶„íˆ ë§ì•˜ë‹¤.\nê·¸ë…€ëŠ” ì´ì œ ëŒ€ê¸°ì—… ì·¨ì—…ì„ ì¤€ë¹„í•˜ê³  ìˆë‹¤.\në©´ì ‘ì„ ì•ë‘ê³ , ë‹¹ì‹ ì€ ëª¨ë“  ìë£Œë¥¼ ì´ë™ì›í•´ ê·¸ë…€ì˜ ë„ì „ì„ í•¨ê»˜í•œë‹¤.", "L8_Recipe_Bento_Cook_Midnight": "ë‹¤ìŒ ë‚  ì¼ì° ë‚˜ê°€ì•¼ í•  ë‹¹ì‹ ì„ ìœ„í•´,\nì•„ì¹¨ ì¼ì° í•¨ê»˜ ìš”ë¦¬ë¥¼ í•´ì„œ ë³´ì˜¨ ë„ì‹œë½ì— ì •ì„±ê» ë‹´ì•„ì¤¬ë‹¤.\nì‚¬ë‘ì´ ë¬»ì–´ë‚˜ëŠ” ë„ì‹œë½ì´ì—ˆë‹¤.", "L8_STM35_Walk_Sleep": "ì ë“¤ê¸° ì „, ê°€ë³ê²Œ ë™ë„¤ë¥¼ í•œ ë°”í€´ ì‚°ì±…í•˜ë©° í•˜ë£¨ë¥¼ ì •ë¦¬í•˜ê³ ,\nì§‘ì— ëŒì•„ì™€ í¸ì•ˆí•˜ê²Œ í•¨ê»˜ ì ìë¦¬ì— ë“œëŠ” ì´ìƒì ì¸ ë¶€ë¶€ì˜ ëª¨ìŠµ.", "L8_STR0to40_Bathsalt_Bath_Tea": "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ê±°ì˜ ì—†ëŠ” í‰ì˜¨í•œ ë‚ ,\ní•¨ê»˜ ì…ìš•ì œë¡œ ëª©ìš•ì„ ì¦ê¸°ê³  ë‚˜ì˜¨ ë’¤\në”°ëœ»í•œ ì°¨ë¥¼ ë§ˆì‹œë©° ì™„ë²½í•˜ê²Œ ì—¬ìœ ë¡œìš´ íœ´ì‹ì„ ì¦ê¸´ë‹¤.", "L8_StrBelow40_7Days_Mood1": "ë‘ ì‚¬ëŒì˜ ìƒí™œì€ ì•ˆì •ì ì´ê³  í–‰ë³µí•œ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆë‹¤.\në‹¹ì‹ ê³¼ ê·¸ë…€ëŠ” ì„œë¡œë¥¼ ì™„ë²½í•œ ë™ë°˜ìë¡œ ìƒê°í•˜ê³  ìˆë‹¤.", "L8_TRU80_Ring_Talk": "ë‹¹ì‹ ì€ ì§„ì§€í•œ ëŒ€í™”ë¥¼ ì²­í•˜ë©° ì¤€ë¹„í•œ ë°˜ì§€ë¥¼ êº¼ë‚¸ë‹¤.\nê·¸ë…€ëŠ” ë°›ìë§ˆì ê¸°ìœ ë“¯ì´ ë‹¹ì‹ ì—ê²Œ ì•ˆê²¼ê³ ,\në‘ ì‚¬ëŒì€ í‰ìƒì„ ì•½ì†í•œë‹¤.", "L8_TRU85_Blanket_SleepTogether": "ë‘ ì‚¬ëŒì—ê²Œ í•¨ê»˜ ì ë“œëŠ” ê²ƒì€ ìˆ¨ ì‰¬ëŠ” ê²ƒì²˜ëŸ¼ ìì—°ìŠ¤ëŸ¬ìš´ ì¼ì´ë‹¤.\nì„œë¡œëŠ” ì´ì œ ë¶„ë¦¬í•  ìˆ˜ ì—†ëŠ” ì¡´ì¬ê°€ ë˜ì—ˆë‹¤."}, "levelup": {"L2": "ì²˜ìŒì—” ì–´ìƒ‰í•œ ì¹¨ë¬µì´ íë¥´ê¸°ë„ í–ˆì§€ë§Œ,\nì‚¬ì†Œí•œ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê³  í•¨ê»˜ ì‹œê°„ì„ ë³´ë‚´ë©° ì„œë¡œë¥¼ ì•Œì•„ê°”ë‹¤.\nì–´ëŠìƒˆ ê·¸ë…€ëŠ” ë‚˜ì—ê²Œ ì¡°ê¸ˆì”© ë§ˆìŒì˜ ë¬¸ì„ ì—´ê¸° ì‹œì‘í–ˆë‹¤.\nì´ì œëŠ” ê³ì—ì„œ ê°€ë§Œíˆ ë¨¸ë¦¬ë¥¼ ì“°ë‹¤ë“¬ì–´ ì£¼ì–´ë„ ë  ê²ƒ ê°™ë‹¤.", "L3": "í•¨ê»˜ ë³´ë‚´ëŠ” ì‹œê°„ì´ ì ì  ë” íŠ¹ë³„í•˜ê²Œ ëŠê»´ì§€ê¸° ì‹œì‘í–ˆë‹¤.\në‹¨ìˆœí•œ ì¹œêµ¬ê°€ ì•„ë‹ˆë¼, ê·¸ ì´ìƒì˜ ê°ì •ì´ ì‹¹íŠ¸ê³  ìˆìŒì„ ê¹¨ë‹¬ì•˜ë‹¤.\nì´ì œëŠ” ê·¸ë…€ì˜ ì†ì„ ì¡ê³  \"ë°ì´íŠ¸\"ë¼ê³  ë§í•  ìš©ê¸°ê°€ ìƒê²¼ë‹¤.\nìš°ë¦¬ì˜ ì²« ë°ì´íŠ¸ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œ, ë§ˆìŒì´ ì„¤ë ˆê¸° ì‹œì‘í•œë‹¤.", "L4": "ëª‡ ë²ˆì˜ ë°ì´íŠ¸ë¥¼ ê±°ì¹˜ë©° ìš°ë¦¬ëŠ” ë”ìš± ê°€ê¹Œì›Œì¡Œë‹¤.\në§ì—†ì´ í•¨ê»˜ ê±·ëŠ” ê²ƒë§Œìœ¼ë¡œë„ í¸ì•ˆí•¨ì„ ëŠë¼ëŠ” ì‚¬ì´ê°€ ë˜ì—ˆë‹¤.\nì´ì œëŠ” í˜ë“¤ê±°ë‚˜ ê¸°ìœ ì¼ì´ ìˆì„ ë•Œ, ë§ ëŒ€ì‹  ë”°ëœ»í•˜ê²Œ ê»´ì•ˆì•„ì£¼ê³  ì‹¶ë‹¤.\nê·¸ë…€ì˜ ì˜¨ê¸°ë¥¼ ëŠë¼ë©´, ì–´ë–¤ ì–´ë ¤ì›€ë„ ì´ê²¨ë‚¼ ìˆ˜ ìˆì„ ê²ƒë§Œ ê°™ë‹¤.", "L5": "ì„œë¡œë¥¼ ëŒì–´ì•ˆëŠ” ì˜¨ê¸°ì— ìµìˆ™í•´ì§ˆ ë¬´ë µ, ë¬¸ë“ ì‹œì„ ì´ ë§ˆì£¼ì³¤ë‹¤.\nìˆ˜ë§ì€ ê°ì •ì´ ì˜¤ê°€ëŠ” ê·¸ ì§§ì€ ìˆœê°„, ì„¸ìƒì´ ë©ˆì¶˜ ê²ƒ ê°™ì•˜ë‹¤.\në” ì´ìƒ ë§ì„¤ì¼ í•„ìš”ê°€ ì—†ì—ˆë‹¤.\nì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë‹¤ê°€ê°€ ê·¸ë…€ì˜ ì…ìˆ ì— ë‚˜ì˜ ë§ˆìŒì„ ì „í–ˆë‹¤.", "L6": "ë‹¬ì½¤í•œ ì…ë§ì¶¤ì€ ìš°ë¦¬ì˜ ì¼ìƒì´ ë˜ì—ˆë‹¤.\nì´ì œ ì„œë¡œì˜ ê³ì´ ì•„ë‹ˆë©´ ì ë“¤ ìˆ˜ ì—†ì„ ë§Œí¼, ì¡´ì¬ê°€ ê¹Šìˆ™ì´ ìŠ¤ë©°ë“¤ì—ˆë‹¤.\nëŠ¦ì€ ë°¤ ì˜í™”ë¥¼ ë³´ë‹¤ ì†ŒíŒŒì—ì„œ ì ë“  ê·¸ë…€ë¥¼ ë°”ë¼ë³´ë©° ìƒê°í–ˆë‹¤.\nì´ì œëŠ” ê°™ì€ ê³µê°„ì—ì„œ, í•¨ê»˜ ì•„ì¹¨ì„ ë§ì´í•˜ê³  ì‹¶ë‹¤ê³ .", "L7": "í•¨ê»˜ ì ë“¤ê³ , í•¨ê»˜ ëˆˆì„ ëœ¨ëŠ” ì•„ì¹¨ì´ ë°˜ë³µë˜ì—ˆë‹¤.\nìš°ë¦¬ëŠ” ì„œë¡œì—ê²Œ ì–´ë–¤ ëª¨ìŠµë„ ìˆ¨ê¸¸ í•„ìš”ê°€ ì—†ëŠ” ì‚¬ì´ê°€ ë˜ì—ˆë‹¤.\ní•˜ë£¨ì˜ í”¼ë¡œë¥¼ ì”»ì–´ë‚´ëŠ” ì‹œê°„ì¡°ì°¨ í•¨ê»˜ ë‚˜ëˆ„ê³  ì‹¶ì–´ì¡Œë‹¤.\në”°ëœ»í•œ ë¬¼ ì†ì—ì„œ, ì„œë¡œì˜ ê°€ì¥ ì†”ì§í•œ ëª¨ìŠµì„ ë§ˆì£¼í•œë‹¤.", "L8": "í•¨ê»˜ ì›ƒê³ , ìš¸ê³ , ì„œë¡œë¥¼ ë³´ë“¬ìœ¼ë©° ëª¨ë“  ê³„ì ˆì„ ë³´ëƒˆë‹¤.\nê·¸ë…€ëŠ” ë‚˜ì˜ ì¼ìƒì´ì, ë‚˜ì˜ ì„¸ìƒ ê·¸ ìì²´ê°€ ë˜ì—ˆë‹¤.\nì´ì œëŠ” 'ì—°ì¸'ì´ë¼ëŠ” ì´ë¦„ë§Œìœ¼ë¡œëŠ” ì´ ê°ì •ì„ ë‹¤ ë‹´ì„ ìˆ˜ ì—†ì—ˆë‹¤.\nì´ì œ ì˜ì›ì„ ì•½ì†í•  ì‹œê°„ì´ë‹¤."}};



    // ---------------------- UI Wiring ----------------------
    const el = {
      day:qs('#lblDay'), time:qs('#lblTime'), timeText:qs('#timeText'), dot:qs('#dot'),
      level:qs('#lblLevel'),
      vAFF:qs('#vAFF'), vTRU:qs('#vTRU'), vMOT:qs('#vMOT'), vMOOD:qs('#vMOOD'), vSTR:qs('#vSTR'), vSTM:qs('#vSTM'),
      bAFF:qs('#bAFF'), bTRU:qs('#bTRU'), bMOT:qs('#bMOT'), bMOOD:qs('#bMOOD'), bSTR:qs('#bSTR'), bSTM:qs('#bSTM'),
      inv:qs('#inv'),
      pillMult:qs('#pillMult'), pillGold:qs('#pillGold'), pillRepeat:qs('#pillRepeat'), pillStressTier:qs('#pillStressTier'), pillFlags:qs('#pillFlags'),
      illu:qs('#illu'), illuImg:qs('#illuImg'), imgMsg:qs('#imgMsg'),
      actionsMode:qs('#actionsMode'), eventMode:qs('#eventMode'), eventText:qs('#eventText'), btnBack:qs('#btnBack'),
      dinnerMode:qs('#dinnerMode'), btnCook:qs('#btnCook'), btnDineOut:qs('#btnDineOut'),
      toast:qs('#toast')
    };
    // Reset handler
    
(function(){
  const btnReset = document.getElementById('btnReset');
  if(!btnReset) return;
  btnReset.addEventListener('click', ()=>{
    const ok = confirm('ì •ë§ë¡œ ë‹¤ì‹œ ì‹œì‘í• ê¹Œìš”? ì €ì¥ëœ ëª¨ë“  ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤.');
    if(!ok) return;
    try{
      const keys=[];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(!k) continue;
        if(k==='sim_game_save_v1' || k==='vowed' || k.startsWith('ev_')) keys.push(k);
      }
      keys.forEach(k=>localStorage.removeItem(k));
    }catch(e){}
    try{ sessionStorage.setItem('skipSave','1'); }catch(e){}
    location.reload();
  });
})();



    // Action buttons
    document.querySelectorAll('[data-act]').forEach(btn=>{
      btn.addEventListener('click',()=>handleAction(btn.dataset.act));
    });
    el.btnBack.addEventListener('click',()=>switchMode('actions'));
    // Dinner choose buttons
    document.querySelectorAll('[data-dinner]').forEach(b=>b.addEventListener('click',()=>handleDinner(b.dataset.dinner)));

    // ---------------------- Helpers ----------------------
    function qs(s){return document.querySelector(s)}
    function randBetween(a,b){return Math.floor(Math.random()*(b-a+1))+a}
    function clamp(x,a,b){return Math.max(a,Math.min(b,x))}
    function toast(msg){el.toast.textContent=msg;el.toast.classList.add('show');setTimeout(()=>el.toast.classList.remove('show'),1400)}

    

    // --- Resource Floor Lock (GLD/MOT must be >= 0) ---
    function enforceResourceFloorLock(){
      const bad = (S.stats.GLD < 0);
      if(!bad) return false;
      const reason = (S.stats.GLD < 0) ? 'ê³¨ë“œê°€ 0 ë¯¸ë§Œ' : '';
      document.querySelectorAll('button').forEach(b=>{ b.disabled = true; });
      if(el.imgMsg) el.imgMsg.textContent = `ìì› ë¶€ì¡±: ${reason}. ëª¨ë“  ì„ íƒì§€ê°€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.`;
      if(el.eventText) el.eventText.textContent = 'ìì› ë¶€ì¡±ìœ¼ë¡œ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì €ì¥/ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì¬ì‹œì‘í•˜ì„¸ìš”.';
      return true;
    }
// ---- Global helper guards moved out of applyStressLocks ----
function projectedSTMAfterAction(id){
  const def = ACT[id]; if(!def) return S.stats.STM;
  let stm = S.stats.STM;
  let delta = (def.base && typeof def.base[5]==='number') ? def.base[5] : 0;
  // global extra stamina cost
  delta -= 2;
  return stm + delta;
}
function isMotLoweringAction(id){
  const def = ACT[id]; if(!def || !def.base) return false;
  return (def.base[2]||0) < 0;
}
function applyStaminaLocks(){
  document.querySelectorAll('[data-act]').forEach(btn=>{
    const id = btn.dataset.act;
    const wouldNegative = projectedSTMAfterAction(id) < 0;
    if(wouldNegative){ btn.disabled = true; }
  });
}
function applyMotLocks(){
  const motZero = S.stats.MOT <= 0;
  if(!motZero) return;
  document.querySelectorAll('[data-act]').forEach(btn=>{
    const id = btn.dataset.act;
    if(isMotLoweringAction(id)){ btn.disabled = true; }
  });
}


function resetActionButtons(){
  // Re-enable all action buttons before re-applying locks/gates
  document.querySelectorAll('[data-act]').forEach(btn=>{ btn.disabled = false; });
}

function updateUI(){
      el.day.textContent = `${S.day}ì¼ì§¸`;
      const timeNames=['ì•„ì¹¨','ë‚®','ì €ë…'];
      el.timeText.textContent = timeNames[S.slot];
      el.dot.className = 'time-dot '+(['dot-morning','dot-day','dot-evening'][S.slot]);
      // If the lifelong promise event was completed, show vow text instead of level
      const __vowed = (S.flags && S.flags.vowed) || (typeof isEventDone==='function' && isEventDone('L8_TRU80_Ring_Talk')) || (typeof localStorage!=='undefined' && localStorage.getItem('vowed')==='1');
      let __label = __vowed ? 'ğŸ’í‰ìƒì„ ì•½ì†í•¨' : `Lv.${S.level}`;
      if(!__vowed && S.level>=2 && S.level<=7){
        const __done = countLevelEventsDone(S.level);
        __label += ` ${__done}/5`;
      }
      el.level.textContent = __label;
      // Stats
      const {AFF,TRU,MOT,MOOD,STR,STM,GLD}=S.stats;
      el.vAFF.textContent=Math.round(AFF); el.vTRU.textContent=Math.round(TRU); el.vMOT.textContent=Math.round(MOT);
      el.vMOOD.textContent =(MOOD).toFixed(1); el.vSTR.textContent=Math.round(STR); el.vSTM.textContent=Math.round(STM);
      el.bAFF.style.width=clamp(AFF/600*100,0,100)+'%';
      el.bTRU.style.width=clamp(TRU/600*100,0,100)+'%';
      el.bMOT.style.width=clamp(MOT/100*100,0,100)+'%';
      el.bMOOD.style.width=clamp((MOOD+2)/4*100,0,100)+'%';
      el.bSTR.style.width=clamp(STR,0,100)+'%';
      el.bSTM.style.width=clamp(STM,0,100)+'%';
      el.pillGold.textContent = `GLD ${Math.round(GLD)}`;
      // Multipliers
      const m = 1 + 0.2*MOOD; // mood
      const s = clamp(1 - STR/100, 0.5, 1.0);
      el.pillMult.textContent = `ë°°ìˆ˜ m/s ${m.toFixed(2)} / ${s.toFixed(2)}`;
      // Repeat & stress tier
      el.pillRepeat.textContent = `ì—°ì†ì¹´í…Œê³ ë¦¬ Ã—${repeatFactor().toFixed(2)}`;
      el.pillStressTier.textContent = `ìŠ¤íŠ¸ë ˆìŠ¤ ë‹¨ê³„: ${stressTierName()}`;
      // Flags
      el.pillFlags.textContent = `ì˜¤ëŠ˜: ìŠˆí¼${S.flags.visitedSuper?'â—‹':'Ã—'}${isHoliday()?' ãƒ» íœ´ì¼':''}`;
      // Re-enable all action buttons before re-applying gates/locks
      resetActionButtons();
            // Unlock buttons by level
      unlockButtonsByLevel();
      // Disable forbidden by stress tiers
      applyStressLocks();
      // Holiday-only buttons
      document.querySelectorAll('[data-act="volunteer"],[data-act="walk"],[data-act="date"]').forEach(btn=>{
        btn.disabled = btn.dataset.act==='date' ? (S.level<3 || !isHoliday()) : !isHoliday();
      });
      // Cook & dineout state
      el.btnCook.disabled = !S.flags.visitedSuper; // cook enable check
      el.btnDineOut.disabled = !isHoliday();
      // Inventory chips
      renderInv();
          applyStaminaLocks(); applyMotLocks(); enforceResourceFloorLock();
    }

    
function renderInv(){
  const out=[]; 
  for(const [id,st] of Object.entries(S.inventory)){
    const left = st.charges==null? 'âˆ' : st.charges;
    const canUse = ['antidote','bathsalt','calm'].includes(id);
    out.push(`<button class="tag${canUse?' use':''}" data-use="${id}" title="${st.note||''}">${st.name}${st.charges!=null?`Ã—${left}`:''}</button>`);
  }
  el.inv.innerHTML = out.join('');
  // wire usage
  el.inv.querySelectorAll('.tag.use').forEach(btn=>{
    btn.addEventListener('click', ()=>useItem(btn.dataset.use));
  });
}


    function unlockButtonsByLevel(){
      const rules = [
        ['pet',2],['date',3],['hug',4],['kiss',5],['sleepTogether',6],['bathTogether',7]
      ];
      for(const [id,lv] of rules){
        const btn = document.querySelector(`[data-act="${id}"]`);
        if(btn) btn.disabled = S.level < lv;
      }
    
      // auto-save on UI refresh
      saveGame();
}

    function stressTier(){
      const x=S.stats.STR; if(x>=80) return 3; if(x>=60) return 2; if(x>=40) return 1; return 0;
    }
    function stressTierName(){return ['ì •ìƒ','T1 ì˜ˆë¯¼','T2 ê³¼ë¶€í•˜','T3 ë¶•ê´´ ì§ì „'][stressTier()]}

    function applyStressLocks(){
      const t = stressTier();
      const lockIds = new Set();
      if(t>=1){['kiss','sleepTogether','bathTogether'].forEach(id=>lockIds.add(id));}
      if(t>=2){['hug','date','walk'].forEach(id=>lockIds.add(id));}
      if(t>=3){['pet','play','hug','kiss','walk','date','sleepTogether'].forEach(id=>lockIds.add(id));}
      for(const id of ['pet','hug','kiss','walk','date','sleepTogether']){
const btn = document.querySelector(`[data-act="${id}"]`);
        if(btn){
          const gated = (ACT[id]?.tags?.gatedLevel||99) > S.level;
          btn.disabled = btn.disabled || lockIds.has(id) || gated;
        }
      }
    }

    function isHoliday(){ // every 5th day is holiday
      return (S.day % 5) === 0;
    }

    function repeatFactor(){
      const c=S.flags.repeatCount; return [1.0,0.75,0.50,0.35][Math.min(c,3)];
    }

    // ---------------------- Asset Display ----------------------
    function setIllustration(src, altMsg){
      el.illuImg.onload = ()=>{el.imgMsg.textContent=''};
      el.illuImg.onerror = ()=>{
        el.illuImg.removeAttribute('src');
        el.imgMsg.textContent = `${src.replace(/^\//,'')} ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.`;
      };
      el.illuImg.src = src;
    }
    // Robust image fallback: try a list of sources in order (e.g., event-level placeholders up to L8)
    function setIllustrationFallback(srcList){
      if(!Array.isArray(srcList) || srcList.length===0){ return; }
      let i=0;
      const tryNext=()=>{
        if(i>=srcList.length){
          el.illuImg.removeAttribute('src');
          el.imgMsg.textContent = `${srcList[0].replace(/^\//,'')} ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.`;
          return;
        }
        el.illuImg.onload = ()=>{ el.imgMsg.textContent=''; };
        el.illuImg.onerror = ()=>{ i++; tryNext(); };
        el.illuImg.src = srcList[i];
      };
      tryNext();
    }


    // ---------------------- Action Handling ----------------------
    function handleAction(id){
      const def=ACT[id]; if(!def){toast('ì•Œ ìˆ˜ ì—†ëŠ” í–‰ë™');return}
      // Click-time guards: stamina and MOT rules
      if(projectedSTMAfterAction(id) < 0){ toast('STMì´ ë¶€ì¡±í•´: ì´ í–‰ë™ì„ í•˜ë©´ ê¸°ë ¥ì´ ìŒìˆ˜ê°€ ë¼. ë‹¤ë¥¸ í–‰ë™ì„ í•´ë³´ì'); return; }
      if(S.stats.MOT<=0 && isMotLoweringAction(id)){ toast('MOTê°€ 0ì´ì•¼. MOTë¥¼ ë” ë‚®ì¶”ëŠ” í–‰ë™ì€ í•  ìˆ˜ ì—†ì–´'); return; }
      if (S.stats.GLD<0) { toast('ìì› ë¶€ì¡±ìœ¼ë¡œ ì§„í–‰ ë¶ˆê°€'); enforceResourceFloorLock(); return; }
      // Sleep jumps day regardless of slot
      if(id==='sleep'){ doSleep(); return; }

      // Slot limit check
      if(S.slot>2){ toast('ì˜¤ëŠ˜ì€ ë” ì´ìƒ í–‰ë™í•  ìˆ˜ ì—†ì–´'); return; }

      // Validate locks
      if(def.tags?.gatedLevel && S.level<def.tags.gatedLevel){ toast(`Lv.${def.tags.gatedLevel}ì—ì„œ í•´ê¸ˆë¼`); return; }
      // Stress locks enforced via disabled btns, but double-check
      if(isForbiddenByStress(id)){ toast('ì§€ê¸ˆì€ í•˜ê¸° ì–´ë ¤ì›Œâ€¦'); return; }

      // Perform base stat change
      const delta = computeDelta(def,id);
      applyDelta(delta);
      S.dayAff += (delta.AFF||0);
    // Shop handling
      if(def.tags?.shop){ openShop(def.tags.shop); }

      // Display illustration
      const imgPath = def.img || `/img/action_${id}.png`;
      setIllustration(imgPath, 'ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤');

      // Push last action
      pushActHistory(id);

      // Increment slot except shops (shopping still consumes time per spec; keep as consuming)
      S.slot++;

      // STR>=80: force next rest(s)
      handleStressForcedRest();

      // Evening auto dinner & bath
      if(S.slot===3){ openDinnerChooser(); return; }

      // Check sub-events and level-up after each action
      tryTriggerEvents(id);
      checkLevelUp();

      updateUI();
    }

    function isForbiddenByStress(id){
      const t=stressTier();
      const forb1=['kiss','sleepTogether'];
      const forb2=['hug','date','walk'];
      const forb3=['pet','play','hug','kiss','walk','date','sleepTogether'];
      if(t>=3 && forb3.includes(id)) return true;
      if(t>=2 && forb2.includes(id)) return true;
      if(t>=1 && forb1.includes(id)) return true;
      return false;
    }

    
function computeDelta(def,id){
      // Base clone
      let [AFF,TRU,MOT,MOOD,STR,STM,GLD] = def.base;

      // Global difficulty tweaks
      AFF*=0.85; TRU*=0.85; // gains slightly nerfed
      if(def.tags?.study||def.tags?.work||def.tags?.affection){ STR += 2; }
      STM -= 2; // extra stamina cost

      // Mood/Stress multipliers to positive gains only (AFF/TRU/MOT). Negative STR is a reduction and should be multiplied too
      const m = 1 + 0.2*S.stats.MOOD; // mood multiplier
      const s = clamp(1 - S.stats.STR/100, 0.5, 1.0);

      AFF = withVariance(AFF * m * s * levelDampen('AFF'));
      TRU = withVariance(TRU * m * s * levelDampen('TRU'));
      MOT = withVariance(MOT * m * s);

      // Repeat penalty by category if repeating the same category consecutively
      if(S.flags.lastCategory===def.cat){ const rf=repeatFactor(); AFF*=rf; TRU*=rf; MOT*=rf; }

      // Synergies
      if(id==='talk'){
        if(lastActsAre(['tea'])){ AFF*=1.3; TRU*=1.3; }
      }

      // Tea item buffs
      if(id==='tea'){
        if(S.inventory['tealeaf']?.charges>0){ MOOD += 0.3; consume('tealeaf',1); }
      }
      // Music item
      if(id==='play'){
        if(S.inventory['music']?.charges>0){ STR -= 2; consume('music',1); }
      }
      // Blanket chain: restâ†’affection
      if(id==='hug' || id==='pet' || id==='kiss'){
        if(S._lastWasRestBlanket && S.inventory['blanket']){ STR -= 4; }
      }
      // Bathsalt prepared applies to bathTogether, too
      if(id==='bathTogether' && (S.flags.bathsaltReady||0)>0){
        STR -= 6; S.flags.bathsaltReady = Math.max(0,S.flags.bathsaltReady-1);
      }

      return {AFF,TRU,MOT,MOOD,STR,STM,GLD};
    }


    function withVariance(x){
      // Â±20% + crit/fumble
      const swing = S.rng.swing; let mult=1 + (Math.random()*2-1)*swing;
      const r=Math.random(); if(r<S.rng.fumble) mult*=0.5; else if(r< S.rng.fumble+S.rng.crit) mult*=1.6;
      return x*mult;
    }

    function levelDampen(kind){
      // Apply dampen if exceeding (threshold-5)
      const next = LEVEL_THRESH[S.level+1]; if(!next) return 1;
      const current = S.stats[kind==='AFF'?'AFF':'TRU'];
      const over = Math.max(0, current - (next-5));
      if(over<=0) return 1; return 1/(1 + over/60);
    }

    function applyDelta(d){
      const st=S.stats;
      for(const k of ['AFF','TRU','MOT','MOOD','STR','STM','GLD']){
        st[k] += d[k]||0;
      }
      st.MOOD = clamp(st.MOOD, -2, 2);
      st.STR = clamp(st.STR, 0, 100);
      st.STM = clamp(st.STM, 0, 100);
      // (blanket chain handled via pushActHistory)
    }

    function pushActHistory(id){
  const act = ACT[id];
  const cat = act ? act.cat : null;
  // Only update repeat chain when the action is a normal ACT with a category.
  if(cat){
    if(S.flags.lastCategory===cat) S.flags.repeatCount = Math.min(3,S.flags.repeatCount+1);
    else { S.flags.lastCategory=cat; S.flags.repeatCount=0; }
  }
  // Keep recent actions for sequence-based triggers (e.g., 'dinner_cook'), but cap length.
      S.flags.lastTwoActs.push(id); if(S.flags.lastTwoActs.length>6) S.flags.lastTwoActs.shift();
      S.maxRepeatCountToday = Math.max(S.maxRepeatCountToday, S.flags.repeatCount);
      if(id==='super') S.flags.visitedSuper=true;
      if(id==='rest' && S.inventory['blanket']) S._lastWasRestBlanket = true; else S._lastWasRestBlanket=false;
    }

    function lastActsAre(arr){
      const n=arr.length; if(S.flags.lastTwoActs.length<n) return false;
      return JSON.stringify(S.flags.lastTwoActs.slice(-n))===JSON.stringify(arr);
    }

    
// ---------------------- Item Use ----------------------
function useItem(id){
  if(!S.inventory[id]){ toast('ì•„ì´í…œì´ ì—†ì–´'); return; }
  if(id==='antidote'){
    applyDelta({STR:-25});
    consume('antidote',1);
    pushActHistory('use_antidote');
    tryTriggerEvents('use_antidote');
    updateUI();
    toast('í•´ë…ì œ ì‚¬ìš©! STR -25');
    return;
  }
  if(id==='bathsalt'){
    S.flags.bathsaltReady = (S.flags.bathsaltReady||0)+1;
    consume('bathsalt',1);
    pushActHistory('use_bathsalt');
    toast('ì…ìš•ì œ ì¤€ë¹„ ì™„ë£Œ: ë‹¤ìŒ ëª©ìš•ì— ì ìš©');
    updateUI();
    return;
  }
  if(id==='calm'){
    const last = S.flags.lastTwoActs[S.flags.lastTwoActs.length-1];
    if(last!=='bath' && last!=='bathTogether'){ toast('ëª©ìš• ì§í›„ì— ì‚¬ìš©í•´ì¤˜'); return; }
    applyDelta({STR:-10, MOOD:+0.5});
    consume('calm',1);
    pushActHistory('use_calm');
    tryTriggerEvents('use_calm');
    updateUI();
    toast('ì§„ì •íŒ© ì‚¬ìš©!');
    return;
  }
  toast('ì´ ì•„ì´í…œì€ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´');
}


// ---------------------- Shops ----------------------
    function openShop(kind){
      const list = SHOP[kind]; if(!list) return;
      switchMode('event');
      let html = `ã€${kind==='super'?'ìŠˆí¼':kind==='book'?'ì„œì ':'ì•½êµ­'}ã€‘\nêµ¬ë§¤í•  ì•„ì´í…œì„ ì„ íƒí•˜ì„¸ìš”.`;
      html += "\n\n"+list.map(it=>`- ${it.name} (${it.price}) â€” ${it.note}`).join("\n");
      html += "\n\nì†Œì§€ê¸ˆ: "+Math.round(S.stats.GLD);
      el.eventText.textContent = html;
      // Replace back button to a picker temporarily
      el.btnBack.textContent='ëŒì•„ê°€ê¸°';
      // Provide quick clickable choices by toast (simple)
      el.eventText.onclick = ()=>{
        
const name = prompt('êµ¬ë§¤í•  ì•„ì´í…œ ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥ (ì˜ˆ: ë ˆì‹œí”¼ í‚¤íŠ¸)');
if(!name) return; 
const it=list.find(x=>x.name===name); 
if(!it){toast('ëª©ë¡ì— ì—†ìŒ'); return;}
if(it.id==='ring' && !(S.flags.labels && S.flags.labels.ringBuy)){
  toast('ì•„ì§ <ë°˜ì§€ êµ¬ì… ê°€ëŠ¥>ì´ ì—†ì–´â€¦ (L8 ì´ë²¤íŠ¸ë¡œ íšë“)');
  return;
}
if(S.stats.GLD < it.price){toast('ëˆì´ ë¶€ì¡±í•´'); return;}
S.stats.GLD -= it.price; addItem(it);
toast(`${it.name} êµ¬ì…!`); updateUI(); openShop(kind);

      }
    }

    function addItem(it){
      if(!S.inventory[it.id]) S.inventory[it.id] = {name:it.name, charges:it.charges, note:it.note};
      else if(S.inventory[it.id].charges!=null) S.inventory[it.id].charges += (it.charges||0);
    }
    function consume(id,n){
      const st=S.inventory[id]; if(!st) return; if(st.charges==null) return; st.charges=Math.max(0,st.charges-n);
      if(st.charges===0) delete S.inventory[id];
    }

    // ---------------------- Dinner & Bath (auto at evening) ----------------------
    function openDinnerChooser(){
      switchMode('dinner');
      setIllustration('/img/dinner.png');
    }

    function handleDinner(kind){
      if (S.stats.GLD<0) { toast('ìì› ë¶€ì¡±ìœ¼ë¡œ ì§„í–‰ ë¶ˆê°€'); enforceResourceFloorLock(); return; }
      // base effects from spec
      const K={
        conbini:{AFF:1,TRU:0,MOT:0,MOOD:0,STR:-2,STM:+8,GLD:randBetween(-12,-8), img:'/img/dinner_conbini.png'},
        cook:{AFF:3,TRU:2,MOT:0,MOOD:0.5,STR:-4,STM:+8,GLD:randBetween(-18,-10), img:'/img/dinner_cook.png'},
        dineout:{AFF:5,TRU:2,MOT:0,MOOD:1,STR:-4,STM:-8,GLD:randBetween(-50,-25), img:'/img/dinner_out.png'}
      };
      if(kind==='cook' && !S.flags.visitedSuper){ toast('ì˜¤ëŠ˜ì€ ìŠˆí¼ë¥¼ ë‹¤ë…€ì˜¤ì§€ ì•Šì•„ ì§ì ‘ ìš”ë¦¬ ë¶ˆê°€'); return; }
      if(kind==='dineout' && !isHoliday()){ toast('ì™¸ì‹ì€ íœ´ì¼ì—ë§Œ ê°€ëŠ¥'); return; }
      const d=K[kind]; applyDelta(d); setIllustration(d.img);
      pushActHistory('dinner_'+kind);
      // Explicitly hide dinner chooser to avoid overlay sticking
      el.dinnerMode.classList.add('hidden');
      // Mark sequences for event engine
      if(kind==='cook') addCounter('dinner_cook');

      // After dinner â†’ auto bath
      handleBath();
      // Safety: if for any reason UI didn't advance to next day/actions or event, ensure actions are visible.
      setTimeout(()=>{
        try{
          if(!el.eventMode.classList.contains('hidden')) return; // allow events to take precedence
          switchMode('actions');
        }catch(e){}
      }, 0);
    }

    function handleBath(){
      // Bath: single or together if unlocked (auto chooses single; together is manual action elsewhere)
      const bath = {AFF:0,TRU:0,MOT:0,MOOD:0.8,STR:-12,STM:+12,GLD:randBetween(-3,0)};
       // Apply bathsalt if prepared
      if((S.flags.bathsaltReady||0)>0){ bath.STR -= 6; S.flags.bathsaltReady = Math.max(0,S.flags.bathsaltReady-1); }
      applyDelta(bath); setIllustration('/img/bath.png'); pushActHistory('bath');

      // End of day: upkeep & next day
      endOfDay();
    }

    
function endOfDay(){
      // Daily life cost
      S.stats.GLD -= 8;
      let nextMoodPenalty=false; if(S.stats.GLD<0){ nextMoodPenalty=true; }
      // Streak updates
      if(S.maxRepeatCountToday<=1) S.daysLowRepeatStreak++; else S.daysLowRepeatStreak=0;
      if(S.stats.STR<40) S.daysStrBelow40Streak++; else S.daysStrBelow40Streak=0;
      // Reset today flags
      S.flags.visitedSuper=false; S.flags.lastCategory=null; S.flags.repeatCount=0; S.flags.lastTwoActs=[]; S.flags.forcedRest=0;
      // Reset day trackers
      S.dayAff=0; S.maxRepeatCountToday=0;
      // Advance day
      S.day++; S.slot=0;
      // Apply next-day penalties if any
      if(nextMoodPenalty){ S.stats.MOOD = clamp(S.stats.MOOD-1,-2,2); S.stats.TRU = Math.max(0,S.stats.TRU-1); }
      // Daily regen small?
      updateUI(); switchMode('actions');
      // Check events/level
      tryTriggerEvents('dayEnd'); checkLevelUp();
    }


    function doSleep(){
      setIllustration('/img/action_sleep.png');
      // jump to next day immediately
      applyDelta({AFF:0,TRU:0,MOT:2,MOOD:0,STR:-15,STM:+60,GLD:0});
      endOfDay();
    }

    function handleStressForcedRest(){
  // Force auto rest only when STR is extremely high (>=95)
  if(S.stats.STR >= 95){
    S.flags.forcedRest = Math.max(S.flags.forcedRest, 1);
  } else {
    return;
  }
  if(S.flags.forcedRest>0 && S.slot<3){
    const def=ACT['rest']; const d=computeDelta(def,'rest');
    applyDelta(d); setIllustration(def.img); pushActHistory('rest');
    S.slot++; S.flags.forcedRest--; toast('ê·¹ì‹¬í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ìë™ íœ´ì‹!');
  }
}

    function switchMode(which){
      el.actionsMode.classList.add('hidden'); el.eventMode.classList.add('hidden'); el.dinnerMode.classList.add('hidden');
      if(which==='actions') el.actionsMode.classList.remove('hidden');
      else if(which==='event'){ el.eventMode.classList.remove('hidden'); }
      else if(which==='dinner'){ el.dinnerMode.classList.remove('hidden'); }
      updateUI();
    }

    // ---------------------- Event Engine ----------------------
    const counters={};
// Per-level counters: only actions performed after entering a given level are counted for that level.
const lvlCounters={};
function addLevelCounter(k, lvl){
  lvl = (lvl==null ? S.level : lvl);
  if(!lvlCounters[lvl]) lvlCounters[lvl] = {};
  lvlCounters[lvl][k] = (lvlCounters[lvl][k]||0) + 1;
}
function addCounter(k){
  // Keep legacy global counters for meta checks, but also track per-level for event counters.
  counters[k]=(counters[k]||0)+1;
  addLevelCounter(k, S.level);
}

    function tryTriggerEvents(lastId){
      // meta tracking
      addCounter(lastId);
      if(lastId==='study'){ addCounter('study_last3'); }
      if(lastId==='dinner_cook'){ addCounter('dinner_cook'); }
      if(lastId==='dinner_dineout'){ addCounter('dinner_dineout'); }
      if(lastId==='bath' || lastId==='bathTogether'){ addCounter('bath'); }
      if(['talk','play','study','rest','tea','sleep','work','super','book','pharm','volunteer','walk','date','kiss','hug','pet','sleepTogether','bathTogether'].includes(lastId)){
        addCounter('todayCats_'+(ACT[lastId]?.cat||'ê¸°íƒ€'));
      }
      // three distinct categories in a day
      const cats = new Set(S.flags.lastTwoActs.map(id=>ACT[id]?.cat).filter(Boolean));
      if(cats.size>=3) addCounter('threeDistinctCatsToday');
      for(const ev of EVENTS){
        if(ev.once && isEventDone(ev.id)) continue;
        if(S.level<ev.level) continue; // only previous/equals? allow at or after level
        if(!matchEvent(ev)) continue;
        fireEvent(ev); break;
      }
    }

    
function matchEvent(ev){
      const s=S.stats;
      if(ev.trigger.stats){
        for(const [k,cond] of Object.entries(ev.trigger.stats)){
          if(cond.gte!=null && !(s[k]>=cond.gte)) return false;
          if(cond.lte!=null && !(s[k]<=cond.lte)) return false;
          if(cond.gt!=null && !(s[k]>cond.gt)) return false;
          if(cond.lt!=null && !(s[k]<cond.lt)) return false;
        }
      }
      if(ev.trigger.items){
        for(const it of ev.trigger.items){ if(!S.inventory[it]) return false; }
      }
      if(ev.trigger.sequence){
        const n=ev.trigger.sequence.length;
        if(JSON.stringify(S.flags.lastTwoActs.slice(-n))!==JSON.stringify(ev.trigger.sequence)) return false;
      }
      if(ev.trigger.counter){
  const __lvlMap = (lvlCounters[ev.level]||{});
  for(const [key,need] of Object.entries(ev.trigger.counter)){
    if((__lvlMap[key]||0) < need) return false;
  }
}
      if(ev.trigger.meta){
        if(ev.trigger.meta.threeDistinctCats && counters['threeDistinctCatsToday']==null) return false;
        if(ev.trigger.meta.study2in3 && (S.flags.lastTwoActs.filter(x=>x==='study').length<2)) return false;
        if(ev.trigger.meta.noRepeat && S.flags.repeatCount>0) return false;
        if(ev.trigger.meta.mixedSW3){
          const last = S.flags.lastTwoActs;
          const sw = last.filter(x=>x==='study' || x==='work').length;
          if(sw<3 || !(last.includes('study') && last.includes('work'))) return false;
        }
        if(ev.trigger.meta.todayAff16 && S.dayAff<16) return false;
        if(typeof ev.trigger.meta.strBelow40Streak==='number' && S.daysStrBelow40Streak < ev.trigger.meta.strBelow40Streak) return false;
        if(typeof ev.trigger.meta.lowRepeatStreak==='number' && S.daysLowRepeatStreak < ev.trigger.meta.lowRepeatStreak) return false;
        if(typeof ev.trigger.meta.moodAtLeast==='number' && S.stats.MOOD < ev.trigger.meta.moodAtLeast) return false;
      }
      if(ev.time==='evening' && S.slot!==2) return false;
      return true;
    }


    
function fireEvent(ev){
      // Apply reward immediately
      applyDelta(ev.reward||{});
      if(ev.reward && ev.reward.LABEL==='ringBuy'){
        if(!S.flags.labels) S.flags.labels={};
        S.flags.labels.ringBuy = true;
        toast('<ë°˜ì§€ êµ¬ì… ê°€ëŠ¥> ë¼ë²¨ì„ ì–»ì—ˆë‹¤!');
      }
      markEventDone(ev.id);
      if(ev.id==='L8_TRU80_Ring_Talk'){ S.flags.vowed = true; try{ localStorage.setItem('vowed','1'); }catch(e){} }

      // Register completed to previous level bucket (for level-up rule)
      S.completedByLevel[Math.max(1, ev.level-1)]?.add(ev.id);

      // Load assets: /events/{id}.png + .txt (fallback message if missing)
      setIllustrationFallback([`/events/${ev.id}.png`,`/events/L${ev.level}/${ev.id}.png`,`/events/L${ev.level}.png`,`/events/placeholder.png`]);
      switchMode('event');
      try{ el.eventText.textContent = (TEXTS.events[ev.id] ?? (`events/${ev.id}.txt ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.`)); }catch(e){ el.eventText.textContent = `events/${ev.id}.txt ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.`; }
      updateUI();
    }
    function isEventDone(id){ return localStorage.getItem('ev_'+id)==='1'; }
    function markEventDone(id){ localStorage.setItem('ev_'+id,'1'); }

    // ---------------------- Level Up ----------------------
    function checkLevelUp(){
      const next=S.level+1; const need=LEVEL_THRESH[next]; if(!need) return;
      const hasAff = S.stats.AFF >= need;
      // count distinct 7/11 of prev stage
      const prev= S.level; const done = S.completedByLevel[prev] ? S.completedByLevel[prev].size : 0;
      if(prev===1){ // L1â†’L2: no subevents requirement per spec
        if(hasAff){ doLevelUp(next); }
        return;
      }
      if(hasAff && done>=5){ doLevelUp(next); }
    }

    function doLevelUp(nextLv){
      S.level = nextLv; toast(`ë ˆë²¨ ${nextLv} ë‹¬ì„±!`);
      // Show level-up assets
      setIllustrationFallback([`/levelup/L${nextLv}.png`,`/events/L${nextLv}.png`,`/events/placeholder.png`]);
      switchMode('event');
      try{ el.eventText.textContent = (TEXTS.levelup['L'+nextLv] ?? (`levelup/L${nextLv}.txt ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.`)); }catch(e){ el.eventText.textContent = `levelup/L${nextLv}.txt ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.`; }
      updateUI();
    }


    // ---------------------- Persistence ----------------------
    function serializeCompletedByLevel(){
      const out = {};
      for(const k of Object.keys(S.completedByLevel||{})){
        const v = S.completedByLevel[k];
        out[k] = Array.from(v||[]);
      }
      return out;
    }
    function deserializeCompletedByLevel(obj){
      const out = {};
      for(const k of Object.keys(obj||{})){
        out[k] = new Set(obj[k]||[]);
      }
      return out;
    }
    function saveGame(){
      try{
        const payload = {
          S: {
            ...S,
            completedByLevel: serializeCompletedByLevel()
          },
          counters: {...counters},
          lvlCounters: {...lvlCounters}
        };
        localStorage.setItem('sim_game_save_v1', JSON.stringify(payload));
      }catch(e){}
    }
    function loadGame(){
      try{
        const s = localStorage.getItem('sim_game_save_v1');
        if(!s) return false;
        const payload = JSON.parse(s);
        if(payload && payload.S){
          const keep = S; // ensure shape defaults
          Object.assign(S, payload.S);
          S.completedByLevel = deserializeCompletedByLevel(payload.S.completedByLevel||{});
          if(!S.flags) S.flags = {};
          if(!S.flags.lastTwoActs) S.flags.lastTwoActs = [];
          if(!S.inventory) S.inventory = {};
        }
        if(payload && payload.counters){
          Object.assign(counters, payload.counters);
        }
        if(payload && payload.lvlCounters){
          Object.assign(lvlCounters, payload.lvlCounters);
        }
        return true;
      }catch(e){ return false; }
    }
    window.addEventListener('beforeunload', function(){ try{ if(sessionStorage.getItem('skipSave')==='1') return; }catch(e){} saveGame(); });

    // Progress counter per current level (UI-only; do not alter rules)
    function countLevelEventsDone(lv){
      let n=0;
      for(const ev of EVENTS){
        if(ev.level===lv && ev.type==='sub' && isEventDone(ev.id)) n++;
      }
      return n;
    }

    // ---------------------- Boot ----------------------
    try{ S.flags.vowed = (localStorage.getItem('vowed')==='1') || (typeof isEventDone==='function' && isEventDone('L8_TRU80_Ring_Talk')); }catch(e){}
    // Load saved game if exists
    loadGame(); try{ sessionStorage.removeItem('skipSave'); }catch(e){}

    updateUI(); setIllustration('/img/title.png');
  </script>
</body>
</html>
